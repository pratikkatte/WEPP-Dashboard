# WEPP Dashboard

An interactive visualization dashboard for the [WEPP](https://github.com/TurakhiaLab/WEPP/tree/main) (Wastewater-based Epidemiology using Phylogenetic Placements) tool. This dashboard enables researchers and public health officials to explore detected haplotypes, inspect read-level alignments, and visualize unaccounted mutations in the context of a global phylogeny.

## Features

- **Phylogenetic Tree Exploration** â€” Powered by Taxonium for interactive tree navigation
- **Interactive Genome Browser** â€” Mutation tracks and variant visualization via JBrowse2 plugin
- **Real-time Analysis** â€” Read-level analysis and variant inspection capabilities

## Table of Contents

- [Prerequisites](#prerequisites)
- [Quick Start](#quick-start)
- [Installation](#installation)
  - [Option 1: Docker (Recommended)](#option-1-docker-recommended)
  - [Option 2: Build from Source](#option-2-build-from-source)
  - [Option 3: Local Development](#option-3-local-development)
- [Usage](#usage)
- [Configuration](#configuration)

## Prerequisites

- **For Docker deployment:**
  - Docker installed on your system
  - Results folder generated by running the [WEPP tool](https://github.com/TurakhiaLab/WEPP/tree/main)

- **For local development:**
  - Node.js v22 (managed via [nvm](https://github.com/nvm-sh/nvm))
  - Yarn package manager
  - Results folder from WEPP tool

## Quick Start

The dashboard can be initialized directly within the WEPP Docker container by setting `DASHBOARD_ENABLE=TRUE` when running WEPP.

For standalone deployment, copy the results folder generated by WEPP and follow one of the installation options below. 

> âš ï¸ **Make sure you have the latest `projects.json` file, which is located in your `results` folder.**  
> You can select and copy different projects locallyâ€”each project is represented as a directory inside the `results` folder alongside its own data. Always verify that your `projects.json` matches the set of project folders you wish to explore in the dashboard.

### results folder structure

```text
ğŸ“ results
â”œâ”€â”€â”€projects.json                                           # always ensure this is up to date, as it lists every project and links each to its associated data
â””â”€â”€â”€ğŸ“SARS_COV_2_real                                       # (example name) Each project resides in its own uniquely named folder
    â”œâ”€â”€â”€ğŸ“ bams                                             # Output BAM files from the WEPP tool for this project
    â”œâ”€â”€â”€sars_cov_2_reference.fa                             # The reference genome FASTA file for this project
    â”œâ”€â”€â”€sars_cov_2_reference.fa.fai                         # FASTA index file for the reference genome
    â”œâ”€â”€â”€public-2021-12-05.all.masked.pb.jsonl.gz            # Compressed JSONL containing the MAT tree for dashboard loading
    â”œâ”€â”€â”€ other files ...

â””â”€â”€â”€ğŸ“ project 2
    â”œâ”€â”€â”€ğŸ“ bams
    â”œâ”€â”€â”€project_2_reference.fa
    â”œâ”€â”€â”€project_2_reference.fa.fai
    â”œâ”€â”€â”€.jsonl files
    â”œâ”€â”€â”€ other files ...
â””â”€â”€â”€ğŸ“ upload ## data uploaded via uploads are saved here
```

## Installation

### Option 1: Docker (Recommended)

Pull the pre-built Docker image for your architecture:

**For Intel/AMD (x86_64):**
```bash
docker pull pratikkatte7/wepp-dashboard:x86_64
```

**For Apple Silicon or ARM (aarch64):**
```bash
docker pull pratikkatte7/wepp-dashboard:aarch64
```

### Option 2: Build from Source

Build the Docker image locally:

```bash
# Navigate to the repository root
cd /path/to/WEPP-Dashboard

# Build the Docker image
docker build -t wepp-dashboard .
```

### Option 3: Local Development

For development without Docker:

**1. Start the Backend:**

```bash
# Navigate to backend directory
cd taxonium_backend

# Ensure Node.js v22 is active
nvm use 22

# Install dependencies
yarn install

# Start the backend server on port 8080
node --expose-gc server.js --port 8080 --data_file path-to-taxonium.jsonl
```

**2. Start the Frontend:**

```bash
# Navigate to frontend directory
cd dashboard

# Ensure Node.js v22 is active
nvm use 22

# Clean install (recommended)
rm -rf node_modules  # Remove existing modules to prevent conflicts
yarn preinstall      # Run pre-installation scripts
yarn install         # Install dependencies

# Start development server
yarn dev             # Runs on http://localhost:5173
```

**3. Production Build:**

For production deployment:

```bash
cd dashboard
yarn build
serve -s dist -l 5173
```

## Usage

### Running with Docker

```bash
# Navigate to the folder containing your WEPP results
cd /path/to/your/results

# Run the dashboard
# Replace <image> with either:
#   pratikkatte7/wepp-dashboard:x86_64   (for Intel / AMD)
#   pratikkatte7/wepp-dashboard:aarch64  (for Apple Silicon / ARM)
#   wepp-dashboard                       (if you built it locally)

docker run -it \
  -v "$PWD/results:/app/taxonium_backend/results" \
  -e PROJECT_NAME=SARS_COV_2_real \
  -p 80:80 \
  <image>
```

| Flag                                            | Description                                                                                                                    |
| ----------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| `-v $PWD/results:/app/taxonium_backend/results` | Mounts your local `results` folder (from WEPP) into the container so the dashboard can access the project data                 |
| `-e PROJECT_NAME=SARS_COV_2_real`               | Specifies which project folder inside `results/` to load (e.g., `SARS_COV_2_real`)                                             |
| `-p 80:80`                                      | Maps container port **80** (NGINX) to host port **80** â€” change to `-p 8080:80` or any other port if port 80 is already in use                   |


Access the dashboard at: `http://localhost` (or `http://localhost:PORT` if using a different port)

### Running Locally

Ensure your results folder is copied to `taxonium_backend/results/`, then follow the local development steps above.

Access the dashboard at: `http://localhost:5173`