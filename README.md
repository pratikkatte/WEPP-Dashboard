# WEPP Dashboard

An interactive visualization dashboard for the [WEPP](https://github.com/TurakhiaLab/WEPP/tree/main) (Wastewater-based Epidemiology using Phylogenetic Placements) tool. This dashboard enables researchers and public health officials to explore detected haplotypes, inspect read-level alignments, and visualize unaccounted mutations in the context of a global phylogeny.

## Features

- **Phylogenetic Tree Exploration** — Powered by Taxonium for interactive tree navigation
- **Interactive Genome Browser** — Mutation tracks and variant visualization via JBrowse2 plugin
- **Real-time Analysis** — Read-level analysis and variant inspection capabilities

## Table of Contents

- [Prerequisites](#prerequisites)
- [Quick Start](#quick-start)
- [Installation](#installation)
  - [Option 1: Docker (Recommended)](#option-1-docker-recommended)
  - [Option 2: Build from Source](#option-2-build-from-source)
  - [Option 3: Local Development](#option-3-local-development)
- [Usage](#usage)
- [Configuration](#configuration)

## Prerequisites

- **For Docker deployment:**
  - Docker installed on your system
  - Results folder generated by running the [WEPP tool](https://github.com/TurakhiaLab/WEPP/tree/main)

- **For local development:**
  - Node.js v22 (managed via [nvm](https://github.com/nvm-sh/nvm))
  - Yarn package manager
  - Results folder from WEPP tool

## Quick Start

The dashboard can be initialized directly within the WEPP Docker container by setting `DASHBOARD_ENABLE=TRUE` when running WEPP.

For standalone deployment, copy the results folder generated by WEPP and follow one of the installation options below. 

> ⚠️ **Make sure you have the latest `projects.json` file, which is located in your `results` folder.**  
> You can select and copy different projects locally—each project is represented as a directory inside the `results` folder alongside its own data. Always verify that your `projects.json` matches the set of project folders you wish to explore in the dashboard.


## Installation

### Option 1: Docker (Recommended)

Pull the pre-built Docker image for your architecture:

**For Intel/AMD (x86_64):**
```bash
docker pull pratikkatte7/wepp-dashboard:x86_64
```

**For Apple Silicon or ARM (aarch64):**
```bash
docker pull pratikkatte7/wepp-dashboard:aarch64
```

### Option 2: Build from Source

Build the Docker image locally:

```bash
# Navigate to the repository root
cd /path/to/WEPP-Dashboard

# Build the Docker image
docker build -t wepp-dashboard .
```

### Option 3: Local Development

For development without Docker:

**1. Start the Backend:**

```bash
# Navigate to backend directory
cd taxonium_backend

# Ensure Node.js v22 is active
nvm use 22

# Install dependencies
yarn install

# Start the backend server on port 8080
node --expose-gc server.js --port 8080 --data_file path-to-taxonium.jsonl
```

**2. Start the Frontend:**

```bash
# Navigate to frontend directory
cd dashboard

# Ensure Node.js v22 is active
nvm use 22

# Clean install (recommended)
rm -rf node_modules  # Remove existing modules to prevent conflicts
yarn preinstall      # Run pre-installation scripts
yarn install         # Install dependencies

# Start development server
yarn dev             # Runs on http://localhost:5173
```

**3. Production Build:**

For production deployment:

```bash
cd dashboard
yarn build
serve -s dist -l 5173
```

## Usage

### Running with Docker

Navigate to the directory containing your WEPP results:

```bash
cd /path/to/your/results

# Run the dashboard
docker run -v $PWD/results:/app/taxonium_backend/results \
  -e PROJECT_NAME=SARS_COV_2_real \
  -p 80:80 \
  wepp-dashboard:<tag>
  # Where <tag> is either "latest", "x86_64", or "aarch64", depending on your platform
```

**Parameters:**
- `-v $PWD/results:/app/taxonium_backend/results` — Mount your results directory
- `-e PROJECT_NAME=SARS_COV_2_real` — Set the project name that you want to load. 
- `-p 80:80` — Map port 80 (change as needed)

Access the dashboard at: `http://localhost` (or `http://localhost:PORT` if using a different port)

### Running Locally

Ensure your results folder is copied to `taxonium_backend/results/`, then follow the local development steps above.

Access the dashboard at: `http://localhost:5173`