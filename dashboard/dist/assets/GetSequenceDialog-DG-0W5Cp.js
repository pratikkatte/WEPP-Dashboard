import{V as L,X as O,o as T,m as D,a as c,u as F,R as e,c as j,D as G,T as R,aI as M,k as _,d as B,F as z,i as A,C as $,e as P,B as q,a8 as H,$ as V,Z as W,v as X}from"./index-8oJY38fj.js";var d={},N;function Z(){if(N)return d;N=1,Object.defineProperty(d,"__esModule",{value:!0}),d.formatFastaLines=s,d.formatSeqFasta=o;function s(r){return r.replaceAll(/(.{1,80})/g,`$1
`).trimEnd()}function o(r){return r.map(n=>`>${n.header}
${s(n.seq)}`).join(`
`)}return d}var J=Z();const K=L(O.jsx("path",{d:"M19 9h-4V3H9v6H5l7 7zM5 18v2h14v-2z"}),"GetApp"),Q=D()({dialogContent:{width:"80em"},textAreaFont:{fontFamily:"Courier New"},ml:{marginLeft:10}});async function U(s,o){const r=F.getSession(s),{leftOffset:n,rightOffset:i}=s;if(!n||!i)throw new Error("no offsets on model to use for range");if(n.assemblyName!==i.assemblyName)throw new Error("not able to fetch sequences from multiple assemblies");const{rpcManager:u,assemblyManager:p}=r,l=n.assemblyName||i.assemblyName||"",g=p.get(l);if(!g)throw new Error(`assembly ${l} not found`);const h=X.getConf(g,["sequence","adapter"]),m="getSequence";return u.call(m,"CoreGetFeatures",{adapterConfig:h,regions:o,sessionId:m})}const ee=T(function({model:s,handleClose:o}){const{classes:r}=Q(),[n,i]=c.useState(),[u,p]=c.useState(),[l,g]=c.useState(!1),[h,m]=c.useState(!1),[E,I]=c.useState(!1),{leftOffset:x,rightOffset:w}=s,b=u===void 0;c.useEffect(()=>{const a=new AbortController;return(async()=>{try{const t=s.getSelectedRegions(x,w);if(t.length===0)throw new Error("Selected region is out of bounds");const C=await U(s,t);p(C)}catch(t){console.error(t),i(t)}})(),()=>{a.abort()}},[s,x,w]);const f=u?J.formatSeqFasta(u.map(a=>{let t=a.get("seq");const C=a.get("refName"),v=a.get("start")+1,y=a.get("end"),k=`${C}:${v}-${y}`;if((t==null?void 0:t.length)!==y-v+1)throw new Error(`${k} returned ${t.length.toLocaleString()} bases, but should have returned ${(y-v).toLocaleString()}`);return l&&(t=F.reverse(t)),E&&(t=F.complement(t)),{header:k+(l?"-rev":"")+(E?"-comp":""),seq:t}})):"",S=f?f.length>1e6:!1;return e.createElement(j.Dialog,{maxWidth:"xl",open:!0,onClose:()=>{o(),s.setOffsets()},title:"Reference sequence"},e.createElement(G,null,n?e.createElement(R,{color:"error"},`${n}`):b?e.createElement(M,null,"Retrieving reference sequence...",e.createElement(_,{className:r.ml,size:20,disableShrink:!0})):null,e.createElement(B,{"data-testid":"rubberband-sequence",variant:"outlined",multiline:!0,minRows:5,maxRows:10,disabled:S,className:r.dialogContent,fullWidth:!0,value:S?"Reference sequence too large to display, use the download FASTA button":f,slotProps:{input:{readOnly:!0,classes:{input:r.textAreaFont}}}}),e.createElement(z,null,e.createElement(A,{control:e.createElement($,{value:l,onChange:a=>{g(a.target.checked)}}),label:"Reverse sequence"}),e.createElement(A,{control:e.createElement($,{value:E,onChange:a=>{I(a.target.checked)}}),label:"Complement sequence"})),e.createElement(R,{style:{margin:10}},'Note: Check both boxes for the "reverse complement"')),e.createElement(P,null,e.createElement(q,{onClick:()=>{V(f),m(!0),setTimeout(()=>{m(!1)},500)},disabled:b||!!n||S,color:"primary",startIcon:e.createElement(H.ContentCopy,null)},h?"Copied":"Copy to clipboard"),e.createElement(q,{onClick:()=>{W.saveAs(new Blob([f||""],{type:"text/x-fasta;charset=utf-8"}),"jbrowse_ref_seq.fa")},disabled:b||!!n,color:"primary",startIcon:e.createElement(K,null)},"Download FASTA"),e.createElement(q,{onClick:o,variant:"contained"},"Close")))});export{ee as default};
//# sourceMappingURL=GetSequenceDialog-DG-0W5Cp.js.map
