{"version":3,"file":"GroupByDialog-C67wX6dX.js","sources":["../../node_modules/@jbrowse/plugin-alignments/esm/LinearPileupDisplay/components/GroupByDialog.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Dialog, ErrorMessage, LoadingEllipses } from '@jbrowse/core/ui';\nimport { getContainingTrack, getContainingView, getSession, useDebounce, } from '@jbrowse/core/util';\nimport { Button, DialogActions, DialogContent, MenuItem, TextField, Typography, } from '@mui/material';\nimport { observer } from 'mobx-react';\nimport { getSnapshot } from 'mobx-state-tree';\nimport { getUniqueTags } from '../../shared/getUniqueTags';\nimport { defaultFilterFlags, negFlags, posFlags } from '../../shared/util';\nconst GroupByTagDialog = observer(function (props) {\n    const { model, handleClose } = props;\n    const [tag, setGroupByTag] = useState('');\n    const [tagSet, setGroupByTagSet] = useState();\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState();\n    const validTag = /^[A-Za-z][A-Za-z0-9]$/.exec(tag);\n    const isInvalid = tag.length === 2 && !validTag;\n    const debouncedTag = useDebounce(tag, 1000);\n    const [type, setType] = useState('');\n    useEffect(() => {\n        ;\n        (async () => {\n            try {\n                if (!isInvalid) {\n                    setError(undefined);\n                    setLoading(true);\n                    const vals = await getUniqueTags({\n                        self: model,\n                        tag: debouncedTag,\n                        blocks: getContainingView(model)\n                            .staticBlocks,\n                    });\n                    setGroupByTagSet(vals);\n                }\n            }\n            catch (e) {\n                console.error(e);\n                setError(e);\n            }\n            finally {\n                setLoading(false);\n            }\n        })();\n    }, [model, isInvalid, debouncedTag]);\n    return (React.createElement(Dialog, { open: true, onClose: handleClose, title: \"Group by\" },\n        React.createElement(DialogContent, null,\n            React.createElement(Typography, null, \"NOTE: this will create new session tracks with the \\\"filter by\\\" set to the values chosen here rather than affecting the current track state\"),\n            React.createElement(TextField, { fullWidth: true, value: type, onChange: event => {\n                    setType(event.target.value);\n                }, label: \"Group by...\", select: true },\n                React.createElement(MenuItem, { value: \"strand\" }, \"Strand\"),\n                React.createElement(MenuItem, { value: \"tag\" }, \"Tag\")),\n            type === 'tag' ? (React.createElement(React.Fragment, null,\n                React.createElement(Typography, { color: \"textSecondary\" }, \"Examples: HP for haplotype, RG for read group, etc.\"),\n                React.createElement(TextField, { value: tag, onChange: event => {\n                        setGroupByTag(event.target.value);\n                    }, placeholder: \"Enter tag name\", error: isInvalid, helperText: isInvalid ? 'Not a valid tag' : '', autoComplete: \"off\", \"data-testid\": \"group-tag-name\", slotProps: {\n                        htmlInput: {\n                            maxLength: 2,\n                            'data-testid': 'group-tag-name-input',\n                        },\n                    } }),\n                error ? (React.createElement(ErrorMessage, { error: error })) : loading ? (React.createElement(LoadingEllipses, { title: \"Loading unique tags\" })) : tagSet ? (React.createElement(\"div\", null,\n                    React.createElement(\"div\", null,\n                        \"Found unique \",\n                        tag,\n                        \" values:\"),\n                    React.createElement(\"div\", null, tagSet.join(', ')))) : null)) : null),\n        React.createElement(DialogActions, null,\n            React.createElement(Button, { variant: \"contained\", color: \"primary\", type: \"submit\", disabled: !tagSet, autoFocus: true, onClick: () => {\n                    const track = getContainingTrack(model);\n                    const trackConf = structuredClone(getSnapshot(track.configuration));\n                    const session = getSession(model);\n                    const view = getContainingView(model);\n                    if (type === 'tag') {\n                        if (tagSet) {\n                            const ret = [...tagSet, undefined];\n                            for (const tagValue of ret) {\n                                const t1 = `${trackConf.trackId}-${tag}:${tagValue}-${+Date.now()}-sessionTrack`;\n                                session.addTrackConf({\n                                    ...trackConf,\n                                    trackId: t1,\n                                    name: `${trackConf.name} (-)`,\n                                    displays: [\n                                        {\n                                            displayId: `${t1}-LinearAlignmentsDisplay`,\n                                            type: 'LinearAlignmentsDisplay',\n                                            pileupDisplay: {\n                                                displayId: `${t1}-LinearAlignmentsDisplay-LinearPileupDisplay`,\n                                                type: 'LinearPileupDisplay',\n                                                filterBy: {\n                                                    ...defaultFilterFlags,\n                                                    tagFilter: {\n                                                        tag,\n                                                        value: tagValue,\n                                                    },\n                                                },\n                                            },\n                                        },\n                                    ],\n                                });\n                                view.showTrack(t1);\n                            }\n                        }\n                    }\n                    else if (type === 'strand') {\n                        const t1 = `${trackConf.trackId}-${tag}:(-)-${+Date.now()}-sessionTrack`;\n                        const t2 = `${trackConf.trackId}-${tag}:(+)-${+Date.now()}-sessionTrack`;\n                        session.addTrackConf({\n                            ...trackConf,\n                            trackId: t1,\n                            name: `${trackConf.name} (-)`,\n                            displays: [\n                                {\n                                    displayId: `${t1}-LinearAlignmentsDisplay`,\n                                    type: 'LinearAlignmentsDisplay',\n                                    pileupDisplay: {\n                                        displayId: `${t1}-LinearAlignmentsDisplay-LinearPileupDisplay`,\n                                        type: 'LinearPileupDisplay',\n                                        filterBy: negFlags,\n                                    },\n                                },\n                                {\n                                    displayId: `${t1}-LinearSNPCoverageDisplay`,\n                                    type: 'LinearSNPCoverageDisplay',\n                                    filterBy: negFlags,\n                                },\n                            ],\n                        });\n                        session.addTrackConf({\n                            ...trackConf,\n                            trackId: t2,\n                            name: `${trackConf.name} (+)`,\n                            displays: [\n                                {\n                                    displayId: `${t2}-LinearAlignmentsDisplay`,\n                                    type: 'LinearAlignmentsDisplay',\n                                    pileupDisplay: {\n                                        displayId: `${t2}-LinearAlignmentsDisplay-LinearPileupDisplay`,\n                                        type: 'LinearPileupDisplay',\n                                        filterBy: posFlags,\n                                    },\n                                },\n                                {\n                                    displayId: `${t2}-LinearSNPCoverageDisplay`,\n                                    type: 'LinearSNPCoverageDisplay',\n                                    filterBy: posFlags,\n                                },\n                            ],\n                        });\n                        view.showTrack(t1);\n                        view.showTrack(t2);\n                    }\n                    handleClose();\n                } }, \"Submit\"),\n            React.createElement(Button, { variant: \"contained\", color: \"secondary\", onClick: () => {\n                    handleClose();\n                } }, \"Cancel\"))));\n});\nexport default GroupByTagDialog;\n"],"names":["GroupByTagDialog","observer","props","model","handleClose","tag","setGroupByTag","useState","tagSet","setGroupByTagSet","loading","setLoading","error","setError","validTag","isInvalid","debouncedTag","useDebounce","type","setType","useEffect","vals","getUniqueTags","getContainingView","e","React","Dialog","DialogContent","Typography","TextField","event","MenuItem","ErrorMessage","LoadingEllipses","DialogActions","Button","track","getContainingTrack","trackConf","getSnapshot","session","getSession","view","ret","tagValue","t1","defaultFilterFlags","t2","negFlags","posFlags"],"mappings":"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","x_google_ignoreList":[0]}