{"version":3,"file":"UnindexedFastaAdapter-CfFeIYia.js","sources":["../../node_modules/@jbrowse/plugin-sequence/esm/UnindexedFastaAdapter/UnindexedFastaAdapter.js"],"sourcesContent":["import { readConfObject } from '@jbrowse/core/configuration';\nimport { BaseSequenceAdapter } from '@jbrowse/core/data_adapters/BaseAdapter';\nimport { SimpleFeature } from '@jbrowse/core/util';\nimport { openLocation } from '@jbrowse/core/util/io';\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs';\nfunction parseSmallFasta(text) {\n    return new Map(text\n        .split('>')\n        .filter(t => /\\S/.test(t))\n        .map(entryText => {\n        const [defLine, ...seqLines] = entryText.split('\\n');\n        const [id, ...description] = defLine.split(' ');\n        const sequence = seqLines.join('').replace(/\\s/g, '');\n        return [\n            id,\n            {\n                description: description.join(' '),\n                sequence,\n            },\n        ];\n    }));\n}\nexport default class UnindexedFastaAdapter extends BaseSequenceAdapter {\n    async getRefNames(opts) {\n        const { fasta } = await this.setup(opts);\n        return [...fasta.keys()];\n    }\n    async getRegions(opts) {\n        const { fasta } = await this.setup(opts);\n        return [...fasta.entries()].map(([refName, data]) => ({\n            refName,\n            start: 0,\n            end: data.sequence.length,\n        }));\n    }\n    async setupPre(_opts) {\n        const fastaLocation = this.getConf('fastaLocation');\n        const res = parseSmallFasta(await openLocation(fastaLocation, this.pluginManager).readFile('utf8'));\n        return {\n            fasta: new Map([...res.entries()].map(([refName, val]) => {\n                return [\n                    readConfObject(this.config, 'rewriteRefNames', { refName }) ||\n                        refName,\n                    val,\n                ];\n            })),\n        };\n    }\n    async getHeader() {\n        const loc = this.getConf('metadataLocation');\n        return loc.uri === '' || loc.uri === '/path/to/fa.metadata.yaml'\n            ? null\n            : openLocation(loc, this.pluginManager).readFile('utf8');\n    }\n    async setup(opts) {\n        if (!this.setupP) {\n            this.setupP = this.setupPre(opts).catch((e) => {\n                this.setupP = undefined;\n                throw e;\n            });\n        }\n        return this.setupP;\n    }\n    getFeatures(region, opts) {\n        const { refName, start, end } = region;\n        return ObservableCreate(async (observer) => {\n            const { fasta } = await this.setup(opts);\n            const entry = fasta.get(refName);\n            if (entry) {\n                observer.next(new SimpleFeature({\n                    id: `${refName}-${start}-${end}`,\n                    data: {\n                        refName,\n                        start,\n                        end,\n                        seq: entry.sequence.slice(start, end),\n                    },\n                }));\n            }\n            observer.complete();\n        });\n    }\n    freeResources() { }\n}\n"],"names":["parseSmallFasta","text","entryText","defLine","seqLines","id","description","sequence","UnindexedFastaAdapter","BaseSequenceAdapter","opts","fasta","refName","data","_opts","fastaLocation","res","openLocation","val","readConfObject","loc","region","start","end","ObservableCreate","observer","entry","SimpleFeature"],"mappings":"sIAKA,SAASA,EAAgBC,EAAM,CAC3B,OAAO,IAAI,IAAIA,EACV,MAAM,GAAG,EACT,OAAO,GAAK,KAAK,KAAK,CAAC,CAAC,EACxB,IAAIC,GAAa,CAClB,KAAM,CAACC,EAAS,GAAGC,CAAQ,EAAIF,EAAU,MAAM;AAAA,CAAI,EAC7C,CAACG,EAAI,GAAGC,CAAW,EAAIH,EAAQ,MAAM,GAAG,EACxCI,EAAWH,EAAS,KAAK,EAAE,EAAE,QAAQ,MAAO,EAAE,EACpD,MAAO,CACHC,EACA,CACI,YAAaC,EAAY,KAAK,GAAG,EACjC,SAAAC,CACH,CACJ,CACT,CAAK,CAAC,CACN,CACe,MAAMC,UAA8BC,EAAAA,mBAAoB,CACnE,MAAM,YAAYC,EAAM,CACpB,KAAM,CAAE,MAAAC,CAAO,EAAG,MAAM,KAAK,MAAMD,CAAI,EACvC,MAAO,CAAC,GAAGC,EAAM,MAAM,CAC/B,CACI,MAAM,WAAWD,EAAM,CACnB,KAAM,CAAE,MAAAC,CAAO,EAAG,MAAM,KAAK,MAAMD,CAAI,EACvC,MAAO,CAAC,GAAGC,EAAM,QAAS,CAAA,EAAE,IAAI,CAAC,CAACC,EAASC,CAAI,KAAO,CAClD,QAAAD,EACA,MAAO,EACP,IAAKC,EAAK,SAAS,MAC/B,EAAU,CACV,CACI,MAAM,SAASC,EAAO,CAClB,MAAMC,EAAgB,KAAK,QAAQ,eAAe,EAC5CC,EAAMhB,EAAgB,MAAMiB,eAAaF,EAAe,KAAK,aAAa,EAAE,SAAS,MAAM,CAAC,EAClG,MAAO,CACH,MAAO,IAAI,IAAI,CAAC,GAAGC,EAAI,SAAS,EAAE,IAAI,CAAC,CAACJ,EAASM,CAAG,IACzC,CACHC,EAAAA,eAAe,KAAK,OAAQ,kBAAmB,CAAE,QAAAP,CAAO,CAAE,GACtDA,EACJM,CACH,CACJ,CAAC,CACL,CACT,CACI,MAAM,WAAY,CACd,MAAME,EAAM,KAAK,QAAQ,kBAAkB,EAC3C,OAAOA,EAAI,MAAQ,IAAMA,EAAI,MAAQ,4BAC/B,KACAH,EAAY,aAACG,EAAK,KAAK,aAAa,EAAE,SAAS,MAAM,CACnE,CACI,MAAM,MAAMV,EAAM,CACd,OAAK,KAAK,SACN,KAAK,OAAS,KAAK,SAASA,CAAI,EAAE,MAAO,GAAM,CAC3C,WAAK,OAAS,OACR,CACtB,CAAa,GAEE,KAAK,MACpB,CACI,YAAYW,EAAQX,EAAM,CACtB,KAAM,CAAE,QAAAE,EAAS,MAAAU,EAAO,IAAAC,CAAK,EAAGF,EAChC,OAAOG,EAAAA,iBAAiB,MAAOC,GAAa,CACxC,KAAM,CAAE,MAAAd,CAAO,EAAG,MAAM,KAAK,MAAMD,CAAI,EACjCgB,EAAQf,EAAM,IAAIC,CAAO,EAC3Bc,GACAD,EAAS,KAAK,IAAIE,gBAAc,CAC5B,GAAI,GAAGf,CAAO,IAAIU,CAAK,IAAIC,CAAG,GAC9B,KAAM,CACF,QAAAX,EACA,MAAAU,EACA,IAAAC,EACA,IAAKG,EAAM,SAAS,MAAMJ,EAAOC,CAAG,CACvC,CACrB,CAAiB,CAAC,EAENE,EAAS,SAAU,CAC/B,CAAS,CACT,CACI,eAAgB,CAAA,CACpB","x_google_ignoreList":[0]}