const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./FacetedDialog-DROS0Wwn.js","./index-BF7YmVSy.js","./index-7Hk6Ie7E.css","./SanitizedHTML-D6C9MUsD.js","./Clear-CDbyCy8E.js","./CloseConnectionDialog-CMt_XLQL.js","./DeleteConnectionDialog-CE1fDPUs.js","./ManageConnectionsDialog-Cab78RAf.js","./ToggleConnectionsDialog-C5sHtjnZ.js"])))=>i.map(i=>d[i]);
import{a as C,o as M,m as R,u as E,R as d,cj as De,bp as Ae,ck as Ne,M as ce,cl as j,cm as Fe,v as ye,_ as U,V as W,X as D,cn as te,H as He,ae as ne,d as $e,bv as Pe,af as Ie,co as ie,cp as A,cq as re,cr as Be,h as Ue,cs as je,T as qe,i as Ve,C as Ke}from"./index-BF7YmVSy.js";import{C as Ge}from"./Clear-CDbyCy8E.js";import{S as Ce}from"./SanitizedHTML-D6C9MUsD.js";let w;typeof window<"u"?w=window:typeof self<"u"?w=self:w=global;let Z=null,Q=null;const de=20,K=w.clearTimeout,ue=w.setTimeout,G=w.cancelAnimationFrame||w.mozCancelAnimationFrame||w.webkitCancelAnimationFrame,fe=w.requestAnimationFrame||w.mozRequestAnimationFrame||w.webkitRequestAnimationFrame;G==null||fe==null?(Z=K,Q=function(e){return ue(e,de)}):(Z=function([e,t]){G(e),K(t)},Q=function(e){const t=fe(function(){K(r),e()}),r=ue(function(){G(t),e()},de);return[t,r]});function Xe(n){let e,t,r,a,s,o,c;const h=typeof document<"u"&&document.attachEvent;if(!h){o=function(f){const p=f.__resizeTriggers__,m=p.firstElementChild,T=p.lastElementChild,b=m.firstElementChild;T.scrollLeft=T.scrollWidth,T.scrollTop=T.scrollHeight,b.style.width=m.offsetWidth+1+"px",b.style.height=m.offsetHeight+1+"px",m.scrollLeft=m.scrollWidth,m.scrollTop=m.scrollHeight},s=function(f){return f.offsetWidth!==f.__resizeLast__.width||f.offsetHeight!==f.__resizeLast__.height},c=function(f){if(f.target.className&&typeof f.target.className.indexOf=="function"&&f.target.className.indexOf("contract-trigger")<0&&f.target.className.indexOf("expand-trigger")<0)return;const p=this;o(this),this.__resizeRAF__&&Z(this.__resizeRAF__),this.__resizeRAF__=Q(function(){s(p)&&(p.__resizeLast__.width=p.offsetWidth,p.__resizeLast__.height=p.offsetHeight,p.__resizeListeners__.forEach(function(b){b.call(p,f)}))})};let l=!1,v="";r="animationstart";const y="Webkit Moz O ms".split(" ");let i="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),u="";{const f=document.createElement("fakeelement");if(f.style.animationName!==void 0&&(l=!0),l===!1){for(let p=0;p<y.length;p++)if(f.style[y[p]+"AnimationName"]!==void 0){u=y[p],v="-"+u.toLowerCase()+"-",r=i[p],l=!0;break}}}t="resizeanim",e="@"+v+"keyframes "+t+" { from { opacity: 0; } to { opacity: 0; } } ",a=v+"animation: 1ms "+t+"; "}const g=function(l){if(!l.getElementById("detectElementResize")){const v=(e||"")+".resize-triggers { "+(a||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',y=l.head||l.getElementsByTagName("head")[0],i=l.createElement("style");i.id="detectElementResize",i.type="text/css",n!=null&&i.setAttribute("nonce",n),i.styleSheet?i.styleSheet.cssText=v:i.appendChild(l.createTextNode(v)),y.appendChild(i)}};return{addResizeListener:function(l,v){if(h)l.attachEvent("onresize",v);else{if(!l.__resizeTriggers__){const y=l.ownerDocument,i=w.getComputedStyle(l);i&&i.position==="static"&&(l.style.position="relative"),g(y),l.__resizeLast__={},l.__resizeListeners__=[],(l.__resizeTriggers__=y.createElement("div")).className="resize-triggers";const u=y.createElement("div");u.className="expand-trigger",u.appendChild(y.createElement("div"));const f=y.createElement("div");f.className="contract-trigger",l.__resizeTriggers__.appendChild(u),l.__resizeTriggers__.appendChild(f),l.appendChild(l.__resizeTriggers__),o(l),l.addEventListener("scroll",c,!0),r&&(l.__resizeTriggers__.__animationListener__=function(m){m.animationName===t&&o(l)},l.__resizeTriggers__.addEventListener(r,l.__resizeTriggers__.__animationListener__))}l.__resizeListeners__.push(v)}},removeResizeListener:function(l,v){if(h)l.detachEvent("onresize",v);else if(l.__resizeListeners__.splice(l.__resizeListeners__.indexOf(v),1),!l.__resizeListeners__.length){l.removeEventListener("scroll",c,!0),l.__resizeTriggers__.__animationListener__&&(l.__resizeTriggers__.removeEventListener(r,l.__resizeTriggers__.__animationListener__),l.__resizeTriggers__.__animationListener__=null);try{l.__resizeTriggers__=!l.removeChild(l.__resizeTriggers__)}catch{}}}}}class Je extends C.Component{constructor(...e){super(...e),this.state={height:this.props.defaultHeight||0,width:this.props.defaultWidth||0},this._autoSizer=null,this._detectElementResize=null,this._didLogDeprecationWarning=!1,this._parentNode=null,this._resizeObserver=null,this._timeoutId=null,this._onResize=()=>{this._timeoutId=null;const{disableHeight:t,disableWidth:r,onResize:a}=this.props;if(this._parentNode){const s=window.getComputedStyle(this._parentNode)||{},o=parseFloat(s.paddingLeft||"0"),c=parseFloat(s.paddingRight||"0"),h=parseFloat(s.paddingTop||"0"),g=parseFloat(s.paddingBottom||"0"),_=this._parentNode.getBoundingClientRect(),S=_.height-h-g,l=_.width-o-c;if(!t&&this.state.height!==S||!r&&this.state.width!==l){this.setState({height:S,width:l});const v=()=>{this._didLogDeprecationWarning||(this._didLogDeprecationWarning=!0,console.warn("scaledWidth and scaledHeight parameters have been deprecated; use width and height instead"))};typeof a=="function"&&a({height:S,width:l,get scaledHeight(){return v(),S},get scaledWidth(){return v(),l}})}}},this._setRef=t=>{this._autoSizer=t}}componentDidMount(){const{nonce:e}=this.props,t=this._autoSizer?this._autoSizer.parentNode:null;if(t!=null&&t.ownerDocument&&t.ownerDocument.defaultView&&t instanceof t.ownerDocument.defaultView.HTMLElement){this._parentNode=t;const r=t.ownerDocument.defaultView.ResizeObserver;r!=null?(this._resizeObserver=new r(()=>{this._timeoutId=setTimeout(this._onResize,0)}),this._resizeObserver.observe(t)):(this._detectElementResize=Xe(e),this._detectElementResize.addResizeListener(t,this._onResize)),this._onResize()}}componentWillUnmount(){this._parentNode&&(this._detectElementResize&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize),this._timeoutId!==null&&clearTimeout(this._timeoutId),this._resizeObserver&&this._resizeObserver.disconnect())}render(){const{children:e,defaultHeight:t,defaultWidth:r,disableHeight:a=!1,disableWidth:s=!1,doNotBailOutOnEmptyChildren:o=!1,nonce:c,onResize:h,style:g={},tagName:_="div",...S}=this.props,{height:l,width:v}=this.state,y={overflow:"visible"},i={};let u=!1;return a||(l===0&&(u=!0),y.height=0,i.height=l,i.scaledHeight=l),s||(v===0&&(u=!0),y.width=0,i.width=v,i.scaledWidth=v),o&&(u=!1),C.createElement(_,{ref:this._setRef,style:{...y,...g},...S},!u&&e(i))}}const Ye=R()(n=>({fab:{position:"absolute",bottom:n.spacing(6),right:n.spacing(6)}})),Ze=M(function({model:n}){const{classes:e}=Ye(),t=E.getSession(n),[r,a]=C.useState(null);function s(){a(null)}const o=E.isSessionModelWithConnections(t),c=E.isSessionWithAddTracks(t);return c||o?d.createElement(d.Fragment,null,d.createElement(De,{color:"secondary",className:e.fab,onClick:h=>{a(h.currentTarget)}},d.createElement(Ae,null)),d.createElement(Ne,{anchorEl:r,open:!!r,onClose:()=>{a(null)}},o?d.createElement(ce,{onClick:()=>{s(),E.isSessionModelWithWidgets(t)&&t.showWidget(t.addWidget("AddConnectionWidget","addConnectionWidget"))}},"Add connection"):null,c?d.createElement(ce,{onClick:()=>{s(),E.isSessionModelWithWidgets(t)&&t.showWidget(t.addWidget("AddTrackWidget","addTrackWidget",{view:n.view.id}))}},"Add track"):null)):null}),Qe=C.lazy(()=>U(()=>import("./FacetedDialog-DROS0Wwn.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url)),et=C.lazy(()=>U(()=>import("./CloseConnectionDialog-CMt_XLQL.js"),__vite__mapDeps([5,1,2]),import.meta.url)),tt=C.lazy(()=>U(()=>import("./DeleteConnectionDialog-CE1fDPUs.js"),__vite__mapDeps([6,1,2]),import.meta.url)),nt=C.lazy(()=>U(()=>import("./ManageConnectionsDialog-Cab78RAf.js"),__vite__mapDeps([7,1,2]),import.meta.url)),it=C.lazy(()=>U(()=>import("./ToggleConnectionsDialog-C5sHtjnZ.js"),__vite__mapDeps([8,1,2]),import.meta.url)),rt=M(function({model:n}){const e=E.getSession(n),[t,r]=C.useState(),[a,s]=C.useState(),[o,c]=C.useState(!1),[h,g]=C.useState(!1),[_,S]=C.useState(!1);function l(v,y){var i;const u=ye.readConfObject(v,"name"),f=(i=e.prepareToBreakConnection)===null||i===void 0?void 0:i.call(e,v);if(f){const[p,m]=f;Object.keys(m).length>0?r({connectionConf:v,safelyBreakConnection:p,dereferenceTypeCount:m,name:u}):p()}y&&s({name:u,connectionConf:v})}return d.createElement(d.Fragment,null,d.createElement(j,{menuItems:[{label:"Open faceted track selector",onClick:()=>{S(!0)}},...E.isSessionWithAddTracks(e)?[{label:"Add track...",onClick:()=>{E.isSessionModelWithWidgets(e)&&e.showWidget(e.addWidget("AddTrackWidget","addTrackWidget",{view:n.view.id}))}}]:[],{label:"Connections...",subMenu:[...E.isSessionModelWithConnections(e)?[{label:"Turn on/off connections...",onClick:()=>{c(!0)}}]:[],...E.isSessionModelWithConnectionEditing(e)?[{label:"Add connection...",onClick:()=>{E.isSessionModelWithWidgets(e)&&e.showWidget(e.addWidget("AddConnectionWidget","addConnectionWidget"))}},{label:"Delete connections...",onClick:()=>{g(!0)}}]:[]]},{label:"Sort...",type:"subMenu",subMenu:[{label:"Sort tracks by name",type:"checkbox",checked:n.activeSortTrackNames,onClick:()=>{n.setSortTrackNames(!n.activeSortTrackNames)}},{label:"Sort categories by name",type:"checkbox",checked:n.activeSortCategories,onClick:()=>{n.setSortCategories(!n.activeSortCategories)}}]},{label:"Collapse...",type:"subMenu",subMenu:[...n.hasAnySubcategories?[{label:"Collapse subcategories",onClick:()=>{n.collapseSubCategories()}}]:[],{label:"Collapse top-level categories",onClick:()=>{n.collapseTopLevelCategories()}},{label:"Expand all categories",onClick:()=>{n.expandAllCategories()}}]}]},d.createElement(Fe,null)),d.createElement(C.Suspense,{fallback:null},t?d.createElement(et,{modalInfo:t,onClose:()=>{r(void 0)}}):null,a?d.createElement(tt,{handleClose:()=>{s(void 0)},deleteDialogDetails:a,session:e}):null,h?d.createElement(nt,{handleClose:()=>{g(!1)},breakConnection:l,session:e}):null,o?d.createElement(it,{handleClose:()=>{c(!1)},session:e,breakConnection:l}):null,_?d.createElement(Qe,{handleClose:()=>{S(!1)},model:n}):null))}),at=W(D.jsx("path",{d:"M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2M1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2"}),"ShoppingCart"),st=M(function({model:n}){const{selection:e}=n,{pluginManager:t}=E.getEnv(n),r=E.getSession(n),a=t.evaluateExtensionPoint("TrackSelector-multiTrackMenuItems",[],{session:r});return e.length?d.createElement(j,{menuItems:[{label:"Clear",onClick:()=>{n.clearSelection()}},...a.map(s=>({...s,..."onClick"in s?{onClick:()=>{s.onClick(n)}}:{}}))]},d.createElement(te,{badgeContent:e.length,color:"primary"},d.createElement(at,null))):null}),ot=W(D.jsx("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Grade"),ke=W(D.jsx("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreHoriz"),lt=W(D.jsx("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),ct=W(D.jsx("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28z"}),"StarBorderOutlined"),dt=R()({cascadingStyle:{padding:0}}),Ee=function({id:n,trackId:e,stopPropagation:t,model:r,setOpen:a,conf:s}){var o,c;const{classes:h}=dt();return d.createElement(j,{className:h.cascadingStyle,stopPropagation:t,setOpen:a,"data-testid":`htsTrackEntryMenu-${n}`,menuItems:[...((c=(o=E.getSession(r)).getTrackActionMenuItems)===null||c===void 0?void 0:c.call(o,s))||[],r.isFavorite(e)?{label:"Remove from favorites",onClick:()=>{r.removeFromFavorites(e)},icon:ct}:{label:"Add to favorites",onClick:()=>{r.addToFavorites(e)},icon:lt},{label:"Add to selection",onClick:()=>{r.addToSelection([s])}},...r.isSelected(s)?[{label:"Remove from selection",onClick:()=>{r.removeFromSelection([s])}}]:[]]},d.createElement(ke,null))},ze=M(function({model:n,tracks:e,extraMenuItems:t,children:r,onClick:a}){const{view:s}=n,[o,c]=C.useState(!1),h=E.getSession(n);return s?d.createElement(j,{closeAfterItemClick:!1,onClick:a,menuItems:[...e.map(g=>({type:"checkbox",label:d.createElement(d.Fragment,null,d.createElement(Ce,{html:He.getTrackName(g,h)})," ",d.createElement(Ee,{id:g.trackId,trackId:g.trackId,model:n,conf:g,setOpen:c,stopPropagation:!0})),checked:s.tracks.some(_=>_.configuration===g),onClick:()=>{o||n.view.toggleTrack(g.trackId)&&n.addToRecentlyUsed(g.trackId)}})),...t]},r):null}),ut=R()({smallBadge:{height:14},margin:{marginRight:10}}),ft=M(function({model:n}){const{classes:e}=ut(),{view:t,favoriteTracks:r}=n;return t?d.createElement(ze,{onClick:()=>{n.setFavoritesCounter(0)},tracks:r,model:n,extraMenuItems:r.length?[{type:"divider"},{label:"Clear favorites",onClick:()=>{n.clearFavorites()}}]:[{label:"No favorite tracks yet",onClick:()=>{}}]},d.createElement(ne,{title:"Favorite tracks"},d.createElement(te,{classes:{badge:e.smallBadge},color:"secondary",anchorOrigin:{vertical:"bottom",horizontal:"right"},className:e.margin,badgeContent:n.favoritesCounter},d.createElement(ot,null)))):null}),ht=W(D.jsx("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"History"),mt=R()({smallBadge:{height:14}}),gt=M(function({model:n}){const{classes:e}=mt(),{view:t,recentlyUsedCounter:r,recentlyUsedTracks:a}=n;return t?d.createElement(ze,{onClick:()=>{n.setRecentlyUsedCounter(0)},model:n,tracks:a,extraMenuItems:a.length?[{type:"divider"},{label:"Clear recently used",onClick:()=>{n.clearRecentlyUsed()}}]:[{label:"No recently used",onClick:()=>{}}]},d.createElement(ne,{title:"Recently used tracks"},d.createElement(te,{classes:{badge:e.smallBadge},anchorOrigin:{vertical:"bottom",horizontal:"right"},color:"secondary",badgeContent:r},d.createElement(ht,null)))):null}),pt=R()(n=>({searchBox:{margin:n.spacing(2)}})),vt=M(function({model:n}){const{filterText:e}=n,{classes:t}=pt();return d.createElement($e,{className:t.searchBox,label:"Filter tracks",value:e,onChange:r=>{n.setFilterText(r.target.value)},fullWidth:!0,slotProps:{input:{endAdornment:d.createElement(Pe,{position:"end"},d.createElement(Ie,{onClick:()=>{n.clearFilterText()}},d.createElement(Ge,null)))}}})}),_t=M(function({model:n,setHeaderHeight:e}){return d.createElement("div",{ref:t=>{e((t==null?void 0:t.getBoundingClientRect().height)||0)},"data-testid":"hierarchical_track_selector"},d.createElement("div",{style:{display:"flex"}},d.createElement(rt,{model:n}),d.createElement(st,{model:n}),d.createElement(vt,{model:n}),d.createElement(gt,{model:n}),d.createElement(ft,{model:n})))});var he=Number.isNaN||function(e){return typeof e=="number"&&e!==e};function St(n,e){return!!(n===e||he(n)&&he(e))}function bt(n,e){if(n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(!St(n[t],e[t]))return!1;return!0}function X(n,e){e===void 0&&(e=bt);var t,r=[],a,s=!1;function o(){for(var c=[],h=0;h<arguments.length;h++)c[h]=arguments[h];return s&&t===this&&e(c,r)||(a=n.apply(this,c),s=!0,t=this,r=c),a}return o}var Tt=typeof performance=="object"&&typeof performance.now=="function",me=Tt?function(){return performance.now()}:function(){return Date.now()};function ge(n){cancelAnimationFrame(n.id)}function yt(n,e){var t=me();function r(){me()-t>=e?n.call(null):a.id=requestAnimationFrame(r)}var a={id:requestAnimationFrame(r)};return a}var J=-1;function pe(n){if(n===void 0&&(n=!1),J===-1||n){var e=document.createElement("div"),t=e.style;t.width="50px",t.height="50px",t.overflow="scroll",document.body.appendChild(e),J=e.offsetWidth-e.clientWidth,document.body.removeChild(e)}return J}var H=null;function ve(n){if(n===void 0&&(n=!1),H===null||n){var e=document.createElement("div"),t=e.style;t.width="50px",t.height="50px",t.overflow="scroll",t.direction="rtl";var r=document.createElement("div"),a=r.style;return a.width="100px",a.height="100px",e.appendChild(r),document.body.appendChild(e),e.scrollLeft>0?H="positive-descending":(e.scrollLeft=1,e.scrollLeft===0?H="negative":H="positive-ascending"),document.body.removeChild(e),H}return H}var It=150,Ct=function(e,t){return e};function kt(n){var e,t=n.getItemOffset,r=n.getEstimatedTotalSize,a=n.getItemSize,s=n.getOffsetForIndexAndAlignment,o=n.getStartIndexForOffset,c=n.getStopIndexForStartIndex,h=n.initInstanceProps,g=n.shouldResetStyleCacheOnItemSizeChange,_=n.validateProps;return e=function(S){ie(l,S);function l(y){var i;return i=S.call(this,y)||this,i._instanceProps=h(i.props,A(i)),i._outerRef=void 0,i._resetIsScrollingTimeoutId=null,i.state={instance:A(i),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof i.props.initialScrollOffset=="number"?i.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},i._callOnItemsRendered=void 0,i._callOnItemsRendered=X(function(u,f,p,m){return i.props.onItemsRendered({overscanStartIndex:u,overscanStopIndex:f,visibleStartIndex:p,visibleStopIndex:m})}),i._callOnScroll=void 0,i._callOnScroll=X(function(u,f,p){return i.props.onScroll({scrollDirection:u,scrollOffset:f,scrollUpdateWasRequested:p})}),i._getItemStyle=void 0,i._getItemStyle=function(u){var f=i.props,p=f.direction,m=f.itemSize,T=f.layout,b=i._getItemStyleCache(g&&m,g&&T,g&&p),I;if(b.hasOwnProperty(u))I=b[u];else{var k=t(i.props,u,i._instanceProps),x=a(i.props,u,i._instanceProps),z=p==="horizontal"||T==="horizontal",O=p==="rtl",N=z?k:0;b[u]=I={position:"absolute",left:O?void 0:N,right:O?N:void 0,top:z?0:k,height:z?"100%":x,width:z?x:"100%"}}return I},i._getItemStyleCache=void 0,i._getItemStyleCache=X(function(u,f,p){return{}}),i._onScrollHorizontal=function(u){var f=u.currentTarget,p=f.clientWidth,m=f.scrollLeft,T=f.scrollWidth;i.setState(function(b){if(b.scrollOffset===m)return null;var I=i.props.direction,k=m;if(I==="rtl")switch(ve()){case"negative":k=-m;break;case"positive-descending":k=T-p-m;break}return k=Math.max(0,Math.min(k,T-p)),{isScrolling:!0,scrollDirection:b.scrollOffset<k?"forward":"backward",scrollOffset:k,scrollUpdateWasRequested:!1}},i._resetIsScrollingDebounced)},i._onScrollVertical=function(u){var f=u.currentTarget,p=f.clientHeight,m=f.scrollHeight,T=f.scrollTop;i.setState(function(b){if(b.scrollOffset===T)return null;var I=Math.max(0,Math.min(T,m-p));return{isScrolling:!0,scrollDirection:b.scrollOffset<I?"forward":"backward",scrollOffset:I,scrollUpdateWasRequested:!1}},i._resetIsScrollingDebounced)},i._outerRefSetter=function(u){var f=i.props.outerRef;i._outerRef=u,typeof f=="function"?f(u):f!=null&&typeof f=="object"&&f.hasOwnProperty("current")&&(f.current=u)},i._resetIsScrollingDebounced=function(){i._resetIsScrollingTimeoutId!==null&&ge(i._resetIsScrollingTimeoutId),i._resetIsScrollingTimeoutId=yt(i._resetIsScrolling,It)},i._resetIsScrolling=function(){i._resetIsScrollingTimeoutId=null,i.setState({isScrolling:!1},function(){i._getItemStyleCache(-1,null)})},i}l.getDerivedStateFromProps=function(i,u){return Et(i,u),_(i),null};var v=l.prototype;return v.scrollTo=function(i){i=Math.max(0,i),this.setState(function(u){return u.scrollOffset===i?null:{scrollDirection:u.scrollOffset<i?"forward":"backward",scrollOffset:i,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},v.scrollToItem=function(i,u){u===void 0&&(u="auto");var f=this.props,p=f.itemCount,m=f.layout,T=this.state.scrollOffset;i=Math.max(0,Math.min(i,p-1));var b=0;if(this._outerRef){var I=this._outerRef;m==="vertical"?b=I.scrollWidth>I.clientWidth?pe():0:b=I.scrollHeight>I.clientHeight?pe():0}this.scrollTo(s(this.props,i,u,T,this._instanceProps,b))},v.componentDidMount=function(){var i=this.props,u=i.direction,f=i.initialScrollOffset,p=i.layout;if(typeof f=="number"&&this._outerRef!=null){var m=this._outerRef;u==="horizontal"||p==="horizontal"?m.scrollLeft=f:m.scrollTop=f}this._callPropsCallbacks()},v.componentDidUpdate=function(){var i=this.props,u=i.direction,f=i.layout,p=this.state,m=p.scrollOffset,T=p.scrollUpdateWasRequested;if(T&&this._outerRef!=null){var b=this._outerRef;if(u==="horizontal"||f==="horizontal")if(u==="rtl")switch(ve()){case"negative":b.scrollLeft=-m;break;case"positive-ascending":b.scrollLeft=m;break;default:var I=b.clientWidth,k=b.scrollWidth;b.scrollLeft=k-I-m;break}else b.scrollLeft=m;else b.scrollTop=m}this._callPropsCallbacks()},v.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&ge(this._resetIsScrollingTimeoutId)},v.render=function(){var i=this.props,u=i.children,f=i.className,p=i.direction,m=i.height,T=i.innerRef,b=i.innerElementType,I=i.innerTagName,k=i.itemCount,x=i.itemData,z=i.itemKey,O=z===void 0?Ct:z,N=i.layout,q=i.outerElementType,F=i.outerTagName,L=i.style,Me=i.useIsScrolling,Oe=i.width,ae=this.state.isScrolling,V=p==="horizontal"||N==="horizontal",Le=V?this._onScrollHorizontal:this._onScrollVertical,se=this._getRangeToRender(),Re=se[0],We=se[1],oe=[];if(k>0)for(var P=Re;P<=We;P++)oe.push(C.createElement(u,{data:x,key:O(P,x),index:P,isScrolling:Me?ae:void 0,style:this._getItemStyle(P)}));var le=r(this.props,this._instanceProps);return C.createElement(q||F||"div",{className:f,onScroll:Le,ref:this._outerRefSetter,style:re({position:"relative",height:m,width:Oe,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:p},L)},C.createElement(b||I||"div",{children:oe,ref:T,style:{height:V?"100%":le,pointerEvents:ae?"none":void 0,width:V?le:"100%"}}))},v._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var i=this.props.itemCount;if(i>0){var u=this._getRangeToRender(),f=u[0],p=u[1],m=u[2],T=u[3];this._callOnItemsRendered(f,p,m,T)}}if(typeof this.props.onScroll=="function"){var b=this.state,I=b.scrollDirection,k=b.scrollOffset,x=b.scrollUpdateWasRequested;this._callOnScroll(I,k,x)}},v._getRangeToRender=function(){var i=this.props,u=i.itemCount,f=i.overscanCount,p=this.state,m=p.isScrolling,T=p.scrollDirection,b=p.scrollOffset;if(u===0)return[0,0,0,0];var I=o(this.props,b,this._instanceProps),k=c(this.props,I,b,this._instanceProps),x=!m||T==="backward"?Math.max(1,f):1,z=!m||T==="forward"?Math.max(1,f):1;return[Math.max(0,I-x),Math.max(0,Math.min(u-1,k+z)),I,k]},l}(C.PureComponent),e.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},e}var Et=function(e,t){e.children,e.direction,e.height,e.layout,e.innerTagName,e.outerTagName,e.width,t.instance},zt=50,$=function(e,t,r){var a=e,s=a.itemSize,o=r.itemMetadataMap,c=r.lastMeasuredIndex;if(t>c){var h=0;if(c>=0){var g=o[c];h=g.offset+g.size}for(var _=c+1;_<=t;_++){var S=s(_);o[_]={offset:h,size:S},h+=S}r.lastMeasuredIndex=t}return o[t]},wt=function(e,t,r){var a=t.itemMetadataMap,s=t.lastMeasuredIndex,o=s>0?a[s].offset:0;return o>=r?we(e,t,s,0,r):xt(e,t,Math.max(0,s),r)},we=function(e,t,r,a,s){for(;a<=r;){var o=a+Math.floor((r-a)/2),c=$(e,o,t).offset;if(c===s)return o;c<s?a=o+1:c>s&&(r=o-1)}return a>0?a-1:0},xt=function(e,t,r,a){for(var s=e.itemCount,o=1;r<s&&$(e,r,t).offset<a;)r+=o,o*=2;return we(e,t,Math.min(r,s-1),Math.floor(r/2),a)},_e=function(e,t){var r=e.itemCount,a=t.itemMetadataMap,s=t.estimatedItemSize,o=t.lastMeasuredIndex,c=0;if(o>=r&&(o=r-1),o>=0){var h=a[o];c=h.offset+h.size}var g=r-o-1,_=g*s;return c+_},Mt=kt({getItemOffset:function(e,t,r){return $(e,t,r).offset},getItemSize:function(e,t,r){return r.itemMetadataMap[t].size},getEstimatedTotalSize:_e,getOffsetForIndexAndAlignment:function(e,t,r,a,s,o){var c=e.direction,h=e.height,g=e.layout,_=e.width,S=c==="horizontal"||g==="horizontal",l=S?_:h,v=$(e,t,s),y=_e(e,s),i=Math.max(0,Math.min(y-l,v.offset)),u=Math.max(0,v.offset-l+v.size+o);switch(r==="smart"&&(a>=u-l&&a<=i+l?r="auto":r="center"),r){case"start":return i;case"end":return u;case"center":return Math.round(u+(i-u)/2);case"auto":default:return a>=u&&a<=i?a:a<u?u:i}},getStartIndexForOffset:function(e,t,r){return wt(e,r,t)},getStopIndexForStartIndex:function(e,t,r,a){for(var s=e.direction,o=e.height,c=e.itemCount,h=e.layout,g=e.width,_=s==="horizontal"||h==="horizontal",S=_?g:o,l=$(e,t,a),v=r+S,y=l.offset+l.size,i=t;i<c-1&&y<v;)i++,y+=$(e,i,a).size;return i},initInstanceProps:function(e,t){var r=e,a=r.estimatedItemSize,s={itemMetadataMap:{},estimatedItemSize:a||zt,lastMeasuredIndex:-1};return t.resetAfterIndex=function(o,c){c===void 0&&(c=!0),s.lastMeasuredIndex=Math.min(s.lastMeasuredIndex,o-1),t._getItemStyleCache(-1),c&&t.forceUpdate()},s},shouldResetStyleCacheOnItemSizeChange:!1,validateProps:function(e){e.itemSize}});function Ot(n){return function(e){n.forEach(function(t){typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var Y=function(){},Lt=function(e,t){return t===void 0&&(t=null),{child:null,isShown:t?t.public.isOpen&&t.isShown:!0,parent:t,public:e,sibling:null,visited:!1}},Rt=function(e,t){var r=t.getRecordData,a=r(e),s=a.data.id;return s},Wt=function(e){var t=e.index,r=e.data,a=r.component,s=r.getRecordData,o=r.treeData,c=e.style,h=e.isScrolling,g=s(t);return d.createElement(a,Object.assign({isScrolling:h,style:c,treeData:o},g))},Dt=function(e,t,r){var a=e.createRecord,s=t.buildingTaskTimeout,o=t.placeholder,c=t.async,h=c===void 0?!1:c,g=t.treeWalker,_=h&&r.records!==void 0,S=r.records,l=[],v=new Map,y=s?{timeout:s}:void 0,i=new WeakMap,u=g(),f=u.next(),p=f.value,m=a(p.data,r,void 0,_?S.get(p.data.id):void 0);v.set(m.public.data.id,m),i.set(m,p);var T=m,b=!0,I=m,k=o!==void 0&&!(o===null&&!r.order),x=k?function(O){return O.timeRemaining()>0}:function(){return!0},z=function O(N){for(;T!==null;){if(!x(N)){requestIdleCallback(O,y);return}if(T.visited)T.visited=!1,T=T.sibling!==null?T.sibling:T.parent,I=T;else{var q=u.next(i.get(T)),F=q.value;if(F===void 0){b?b=!1:(T.isShown&&l.push(T.public.data.id),T.visited=T.child!==null,T=T.child!==null?T.child:T.sibling!==null?T.sibling:T.parent),I=T;continue}var L=a(F.data,r,b?void 0:T,_?S.get(F.data.id):void 0);v.set(L.public.data.id,L),i.set(L,F),!b&&I===T?I.child=L:I.sibling=L,I=L}}k&&r.setState({order:l,records:v,updateRequest:{}})};return k?requestIdleCallback(z,y):z(),o!==void 0&&h&&r.order?r:{order:l,records:v}},Se=32768,At=2,Nt=function(e,t){var r=e.order,a=e.records,s=t.opennessState;if(typeof s!="object")return null;for(var o in s)if(a.has(o)){var c=s[o],h=a.get(o),g=typeof c=="boolean"?{open:c}:c,_=g.open,S=g.subtreeCallback,l=S===void 0?Y:S,v=Y,y=Y;h.isShown&&(_?function(){for(var u=r.indexOf(o),f=h;f!==null;){if(f.sibling!==null){f=f.sibling;break}f=f.parent}var p=f===null?r.length-1-u:r.indexOf(f.public.data.id)-1-u,m=[[u+1,p]];v=function(b){if(b.isShown=b.parent?b.parent.public.isOpen&&b.parent.isShown:!0,b.isShown){var I=m[m.length-1];I.push(b.public.data.id),I.length===Se+At&&m.push([u+1+Se*m.length,0])}},y=function(){for(var b=0;b<m.length;b++){var I;(I=r).splice.apply(I,m[b])}}}():h.public.isOpen&&function(){var u=r.indexOf(o),f=0;v=function(m){m.isShown&&(f+=1),m.isShown=m.parent?m.parent.public.isOpen&&m.parent.isShown:!0},y=function(){r.splice(u+1,f)}}());for(var i=h;i!==null;)i.visited?(i.visited=!1,i=i===h?null:i.sibling!==null?i.sibling:i.parent):(i.public.isOpen=i===h?_:i.public.isOpen,l(i.public,h.public),i!==h&&v(i),i.visited=i.child!==null,i=i.child!==null?i.child:i===h?null:i.sibling!==null?i.sibling:i.parent);y()}return{order:r,records:a,updateRequest:{}}},Ft=function(e){return function(t,r,a){return a.refresh?Dt(e,t,r):Nt(r,a)}},xe=function(n){ie(e,n),e.getDerivedStateFromProps=function(a,s){var o=a.listRef,c=o===void 0?null:o,h=a.treeWalker,g=s.computeTree,_=s.list,S=s.order,l=s.treeWalker;return re({attachRefs:Ot([_,c])},h!==l||!S?g(a,s,{refresh:!0}):null,{treeWalker:h})};function e(r,a){var s;return s=n.call(this,r,a)||this,s.getRecordData=s.getRecordData.bind(A(s)),s.state={list:C.createRef(),recomputeTree:s.recomputeTree.bind(A(s)),setState:s.setState.bind(A(s))},s}var t=e.prototype;return t.getItemData=function(){var a=this.props,s=a.children,o=a.itemData;return{component:s,getRecordData:this.getRecordData,treeData:o}},t.getRecordData=function(a){var s=this.state,o=s.order,c=s.records;return c.get(o[a]).public},t.recomputeTree=function(a){var s=this;return new Promise(function(o){s.setState(function(c){return c.computeTree(s.props,c,{opennessState:a})},o)})},t.scrollTo=function(a){var s;(s=this.state.list.current)==null||s.scrollTo(a)},t.scrollToItem=function(a,s){var o;(o=this.state.list.current)==null||o.scrollToItem(this.state.order.indexOf(a),s)},e}(C.PureComponent);xe.defaultProps={rowComponent:Wt};var Ht=Ft({createRecord:function(e,t,r,a){var s=t.recomputeTree,o=t.resetAfterId,c=Lt({data:e,height:a?a.public.height:e.defaultHeight,isOpen:a?a.public.isOpen:e.isOpenByDefault,resize:function(g,_){c.public.height=g,o(c.public.data.id,_)},setOpen:function(g){var _;return s((_={},_[e.id]=g,_))}},r);return c}}),$t=function(n){ie(e,n);function e(r,a){var s;return s=n.call(this,r,a)||this,s.getItemSize=s.getItemSize.bind(A(s)),s.state=re({},s.state,{computeTree:Ht,resetAfterId:s.resetAfterId.bind(A(s))}),s}var t=e.prototype;return t.resetAfterId=function(a,s){var o;s===void 0&&(s=!1);var c=this.state,h=c.list,g=c.order;(o=h.current)==null||o.resetAfterIndex(g.indexOf(a),s)},t.recomputeTree=function(a){var s=this;return n.prototype.recomputeTree.call(this,a).then(function(){var o;(o=s.state.list.current)==null||o.resetAfterIndex(0,!0)})},t.render=function(){var a=this.props;a.children;var s=a.placeholder,o=a.itemSize,c=a.rowComponent;a.treeWalker;var h=Be(a,["children","placeholder","itemSize","rowComponent","treeWalker"]),g=this.state,_=g.attachRefs,S=g.order;return s&&S.length===0?s:d.createElement(Mt,Object.assign({},h,{itemCount:S.length,itemData:this.getItemData(),itemKey:Rt,itemSize:o??this.getItemSize,ref:_}),c)},t.getItemSize=function(a){return this.getRecordData(a).height},e}(xe),Pt=je();const Bt=Ue(Pt),Ut=W(D.jsx("path",{d:"m7 10 5 5 5-5z"}),"ArrowDropDown"),jt=W(D.jsx("path",{d:"m10 17 5-5-5-5z"}),"ArrowRight");function ee(n){return(n==null?void 0:n.type)==="category"?n.children.map(e=>e.type==="category"?ee(e):e.conf).flat(Number.POSITIVE_INFINITY):[]}function B(n,e=new Map){n.id&&n.children.length&&e.set(n.id,n);for(const t of n.children)B(t,e);return e}function qt(n=""){return n.endsWith("(Unsupported)")||n.endsWith("(Unknown)")}const Vt=R()(n=>({contrastColor:{color:n.palette.tertiary.contrastText},accordionText:{margin:"auto 0",width:"100%"}}));function Kt({isOpen:n,setOpen:e,data:t}){const{classes:r}=Vt(),[a,s]=C.useState(null),{menuItems:o=[],name:c,model:h,id:g,tree:_}=t;return d.createElement("div",{className:r.accordionText,onClick:()=>{a||(t.toggleCollapse(g),e(!n))}},d.createElement(qe,{"data-testid":`htsCategory-${c}`},n?d.createElement(Ut,null):d.createElement(jt,null),c,d.createElement(Ie,{onClick:S=>{s(S.currentTarget),S.stopPropagation()},className:r.contrastColor},d.createElement(ke,null))),a?d.createElement(Bt,{anchorEl:a,menuItems:[{label:"Add to selection",onClick:()=>{const S=B(_).get(g);h.addToSelection(ee(S))}},{label:"Remove from selection",onClick:()=>{const S=B(_).get(g);h.removeFromSelection(ee(S))}},{label:"Show all tracks",onClick:()=>{var S;for(const l of((S=B(_).get(g))===null||S===void 0?void 0:S.children)||[])l.type==="track"&&h.view.showTrack(l.trackId)}},{label:"Hide all tracks",onClick:()=>{var S;for(const l of((S=B(_).get(g))===null||S===void 0?void 0:S.children)||[])l.type==="track"&&h.view.hideTrack(l.trackId)}},...o],onMenuItemClick:(S,l)=>{l(),s(null)},open:!!a,onClose:()=>{s(null)}}):null)}const Gt=R()(n=>({compactCheckbox:{padding:0},checkboxLabel:{marginRight:0,"&:hover":{backgroundColor:n.palette.action.selected}},selected:{background:"#cccc"}}));function Xt({data:n}){const{classes:e}=Gt(),{checked:t,conf:r,model:a,drawerPosition:s,id:o,trackId:c,name:h,onChange:g,selected:_}=n,S=ye.readConfObject(r,"description");return d.createElement(d.Fragment,null,d.createElement(ne,{title:S+(_?" (in selection)":""),placement:s==="left"?"right":"left"},d.createElement(Ve,{className:e.checkboxLabel,control:d.createElement(Ke,{className:e.compactCheckbox,checked:t,onChange:()=>{g(c)},disabled:qt(h),inputProps:{"data-testid":`htsTrackEntry-${o}`}}),label:d.createElement("div",{"data-testid":`htsTrackLabel-${o}`,style:{background:_?"#cccc":void 0}},d.createElement(Ce,{html:h}))})),d.createElement(Ee,{model:a,trackId:c,id:o,conf:r}))}const Jt=R()(n=>({accordionBase:{display:"flex"},accordionCard:{padding:3,cursor:"pointer",display:"flex"},nestingLevelMarker:{position:"absolute",borderLeft:"1.5px solid #555"},accordionColor:{background:n.palette.tertiary.main,color:n.palette.tertiary.contrastText,width:"100%",display:"flex",paddingLeft:5}}));function Yt({data:n,isOpen:e,style:t,setOpen:r}){const{isLeaf:a,nestingLevel:s}=n,{classes:o}=Jt(),c=10,h=s*c+(a?c:0);return d.createElement("div",{style:t,className:a?void 0:o.accordionBase},new Array(s).fill(0).map((g,_)=>d.createElement("div",{key:`mark-${_}`,style:{left:_*c+4,height:t==null?void 0:t.height},className:o.nestingLevelMarker})),d.createElement("div",{className:a?void 0:o.accordionCard,style:{marginLeft:h,whiteSpace:"nowrap",width:"100%"}},d.createElement("div",{className:a?void 0:o.accordionColor},a?d.createElement(Xt,{data:n}):d.createElement(Kt,{isOpen:e,data:n,setOpen:r}))))}function be(n,e,t,r){const a=n.type==="track",s=a?r[n.trackId]:!1;return{data:{defaultHeight:a?22:40,isLeaf:a,isOpenByDefault:!0,nestingLevel:e,selected:s,...n,...t},nestingLevel:e,node:n}}const Te=M(function({height:e,tree:t,model:r}){const{filterText:a,selection:s,view:o}=r,c=C.useRef(null),h=E.getSession(r),{drawerPosition:g}=h,_=C.useMemo(()=>Object.fromEntries(s.map(v=>[v.trackId,v])),[s]),S=C.useMemo(()=>({onChange:v=>{o.toggleTrack(v)&&r.addToRecentlyUsed(v)},toggleCollapse:v=>{r.toggleCategory(v)},tree:t,model:r,drawerPosition:g}),[o,r,g,t]),l=C.useCallback(function*(){for(const y of t.children)yield be(y,0,S,_);for(;;){const y=yield;for(const i of y.node.children)yield be(i,y.nestingLevel+1,S,_)}},[t,S,_]);return C.useEffect(()=>{c.current.recomputeTree({refreshNodes:!0,useDefaultHeight:!0})},[t,a]),d.createElement(d.Fragment,null,d.createElement($t,{ref:c,treeWalker:l,height:e},Yt))}),Zt=({tree:n,model:e,offset:t})=>typeof jest>"u"?d.createElement(Je,{disableWidth:!0},r=>d.createElement(Te,{height:(r.height||t)-t,model:e,tree:n})):d.createElement(Te,{height:9e3,model:e,tree:n}),Qt=({overrideDimensions:n,children:e})=>n?d.createElement("div",{style:{...n}},e):e,en=M(function({model:n,toolbarHeight:e,overrideDimensions:t}){return d.createElement(Qt,{overrideDimensions:t},d.createElement(tn,{model:n,toolbarHeight:e}),d.createElement(Ze,{model:n}))}),tn=M(function({model:n,toolbarHeight:e=0}){const[t,r]=C.useState(0);return d.createElement(d.Fragment,null,d.createElement(_t,{model:n,setHeaderHeight:r}),d.createElement(Zt,{tree:n.hierarchy,model:n,offset:e+t}))}),sn=Object.freeze(Object.defineProperty({__proto__:null,default:en},Symbol.toStringTag,{value:"Module"}));export{sn as H,st as S,Ee as T};
//# sourceMappingURL=HierarchicalTrackSelector-DK211DAJ.js.map
