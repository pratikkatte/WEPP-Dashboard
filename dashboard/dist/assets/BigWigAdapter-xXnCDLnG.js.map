{"version":3,"file":"BigWigAdapter-xXnCDLnG.js","sources":["../../node_modules/@gmod/bbi/esm/bigwig.js","../../node_modules/@jbrowse/plugin-wiggle/esm/BigWigAdapter/BigWigAdapter.js"],"sourcesContent":["import { BlockView } from './block-view';\nimport { BBI } from './bbi';\nexport class BigWig extends BBI {\n    /**\n     * Retrieves a BlockView of a specific zoomLevel\n     *\n     * @param scale - number\n     *\n     * @param opts - An object containing basesPerSpan (e.g. pixels per basepair)\n     * or scale used to infer the zoomLevel to use\n     */\n    async getView(scale, opts) {\n        const { zoomLevels, refsByName, isBigEndian, uncompressBufSize } = await this.getHeader(opts);\n        const basesPerPx = 1 / scale;\n        const maxLevel = zoomLevels.length - 1;\n        for (let i = maxLevel; i >= 0; i -= 1) {\n            const zh = zoomLevels[i];\n            // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n            if (zh && zh.reductionLevel <= 2 * basesPerPx) {\n                return new BlockView(this.bbi, refsByName, zh.indexOffset, isBigEndian, uncompressBufSize > 0, 'summary');\n            }\n        }\n        return this.getUnzoomedView(opts);\n    }\n}\n//# sourceMappingURL=bigwig.js.map","import { BigWig } from '@gmod/bbi';\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter';\nimport { updateStatus } from '@jbrowse/core/util';\nimport { openLocation } from '@jbrowse/core/util/io';\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs';\nimport { rectifyStats } from '@jbrowse/core/util/stats';\nclass BigWigAdapter extends BaseFeatureDataAdapter {\n    async setupPre(opts) {\n        const { statusCallback = () => { } } = opts || {};\n        const pm = this.pluginManager;\n        const bigwig = new BigWig({\n            filehandle: openLocation(this.getConf('bigWigLocation'), pm),\n        });\n        const header = await updateStatus('Downloading bigwig header', statusCallback, () => bigwig.getHeader(opts));\n        return { bigwig, header };\n    }\n    async setup(opts) {\n        if (!this.setupP) {\n            this.setupP = this.setupPre(opts).catch((e) => {\n                this.setupP = undefined;\n                throw e;\n            });\n        }\n        return this.setupP;\n    }\n    async getRefNames(opts) {\n        const { header } = await this.setup(opts);\n        return Object.keys(header.refsByName);\n    }\n    async refIdToName(refId) {\n        var _a;\n        const { header } = await this.setup();\n        return (_a = header.refsByNumber[refId]) === null || _a === void 0 ? void 0 : _a.name;\n    }\n    async getGlobalStats(opts) {\n        const { header } = await this.setup(opts);\n        return rectifyStats(header.totalSummary);\n    }\n    getFeatures(region, opts = {}) {\n        const { refName, start, end } = region;\n        const { bpPerPx = 0, stopToken, resolution = 1, statusCallback = () => { }, } = opts;\n        return ObservableCreate(async (observer) => {\n            statusCallback('Downloading bigwig data');\n            const source = this.getConf('source');\n            const resolutionMultiplier = this.getConf('resolutionMultiplier');\n            const { bigwig } = await this.setup(opts);\n            const feats = await bigwig.getFeatures(refName, start, end, {\n                ...opts,\n                basesPerSpan: (bpPerPx / resolution) * resolutionMultiplier,\n            });\n            for (const data of feats) {\n                if (source) {\n                    data.source = source;\n                }\n                const uniqueId = `${source}:${region.refName}:${data.start}-${data.end}`;\n                data.refName = refName;\n                data.uniqueId = uniqueId;\n                observer.next({\n                    get: (str) => data[str],\n                    id: () => uniqueId,\n                    toJSON: () => data,\n                });\n            }\n            observer.complete();\n        }, stopToken);\n    }\n    async getMultiRegionFeatureDensityStats(_regions) {\n        return { featureDensity: 0 };\n    }\n    freeResources() { }\n}\nBigWigAdapter.capabilities = [\n    'hasResolution',\n    'hasLocalStats',\n    'hasGlobalStats',\n];\nexport default BigWigAdapter;\n"],"names":["BigWig","BBI","scale","opts","zoomLevels","refsByName","isBigEndian","uncompressBufSize","basesPerPx","maxLevel","i","zh","BlockView","BigWigAdapter","BaseFeatureDataAdapter","statusCallback","pm","bigwig","openLocation","header","updateStatus","refId","_a","rectifyStats","region","refName","start","end","bpPerPx","stopToken","resolution","ObservableCreate","observer","source","resolutionMultiplier","feats","data","uniqueId","str","_regions"],"mappings":"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","x_google_ignoreList":[0,1]}