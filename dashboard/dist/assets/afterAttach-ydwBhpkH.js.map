{"version":3,"file":"afterAttach-ydwBhpkH.js","sources":["../../node_modules/@jbrowse/plugin-alignments/esm/shared/fetchChains.js","../../node_modules/@jbrowse/plugin-alignments/esm/shared/afterAttach.js"],"sourcesContent":["import { getContainingTrack, getContainingView, getSession, } from '@jbrowse/core/util';\nexport async function fetchChains(self) {\n    const { rpcSessionId: sessionId } = getContainingTrack(self);\n    const { rpcManager } = getSession(self);\n    const view = getContainingView(self);\n    if (!view.initialized || self.error || !self.statsReadyAndRegionNotTooLarge) {\n        return;\n    }\n    self.setLoading(true);\n    const ret = (await rpcManager.call(sessionId, 'PileupGetReducedFeatures', {\n        sessionId,\n        regions: view.staticBlocks.contentBlocks,\n        filterBy: self.filterBy,\n        adapterConfig: self.adapterConfig,\n    }));\n    self.setChainData(ret);\n    self.setLoading(false);\n}\n","import { getContainingView } from '@jbrowse/core/util';\nimport { createAutorun } from '../util';\nimport { fetchChains } from './fetchChains';\nexport function doAfterAttach(self, cb) {\n    createAutorun(self, async () => {\n        await fetchChains(self);\n    }, { delay: 1000 });\n    function draw(view) {\n        const canvas = self.ref;\n        if (!canvas) {\n            return;\n        }\n        const ctx = canvas.getContext('2d');\n        if (!ctx) {\n            return;\n        }\n        if (!self.chainData) {\n            return;\n        }\n        ctx.clearRect(0, 0, canvas.width, self.height * 2);\n        ctx.resetTransform();\n        ctx.scale(2, 2);\n        cb(self, ctx, canvas.width, self.height);\n        self.setLastDrawnOffsetPx(view.offsetPx);\n        self.setLastDrawnBpPerPx(view.bpPerPx);\n    }\n    createAutorun(self, async () => {\n        const view = getContainingView(self);\n        if (view.bpPerPx !== self.lastDrawnBpPerPx) {\n            draw(view);\n        }\n    });\n    createAutorun(self, async () => {\n        const view = getContainingView(self);\n        draw(view);\n    }, { delay: 1000 });\n}\n"],"names":["fetchChains","self","sessionId","getContainingTrack","rpcManager","getSession","view","getContainingView","ret","doAfterAttach","cb","createAutorun","draw","canvas","ctx"],"mappings":"gDACO,eAAeA,EAAYC,EAAM,CACpC,KAAM,CAAE,aAAcC,GAAcC,EAAAA,mBAAmBF,CAAI,EACrD,CAAE,WAAAG,CAAU,EAAKC,EAAU,WAACJ,CAAI,EAChCK,EAAOC,EAAiB,kBAACN,CAAI,EACnC,GAAI,CAACK,EAAK,aAAeL,EAAK,OAAS,CAACA,EAAK,+BACzC,OAEJA,EAAK,WAAW,EAAI,EACpB,MAAMO,EAAO,MAAMJ,EAAW,KAAKF,EAAW,2BAA4B,CACtE,UAAAA,EACA,QAASI,EAAK,aAAa,cAC3B,SAAUL,EAAK,SACf,cAAeA,EAAK,aAC5B,CAAK,EACDA,EAAK,aAAaO,CAAG,EACrBP,EAAK,WAAW,EAAK,CACzB,CCdO,SAASQ,EAAcR,EAAMS,EAAI,CACpCC,EAAcV,EAAM,SAAY,CAC5B,MAAMD,EAAYC,CAAI,CAC9B,EAAO,CAAE,MAAO,IAAM,EAClB,SAASW,EAAKN,EAAM,CAChB,MAAMO,EAASZ,EAAK,IACpB,GAAI,CAACY,EACD,OAEJ,MAAMC,EAAMD,EAAO,WAAW,IAAI,EAC7BC,GAGAb,EAAK,YAGVa,EAAI,UAAU,EAAG,EAAGD,EAAO,MAAOZ,EAAK,OAAS,CAAC,EACjDa,EAAI,eAAgB,EACpBA,EAAI,MAAM,EAAG,CAAC,EACdJ,EAAGT,EAAMa,EAAKD,EAAO,MAAOZ,EAAK,MAAM,EACvCA,EAAK,qBAAqBK,EAAK,QAAQ,EACvCL,EAAK,oBAAoBK,EAAK,OAAO,EAC7C,CACIK,EAAcV,EAAM,SAAY,CAC5B,MAAMK,EAAOC,EAAiB,kBAACN,CAAI,EAC/BK,EAAK,UAAYL,EAAK,kBACtBW,EAAKN,CAAI,CAErB,CAAK,EACDK,EAAcV,EAAM,SAAY,CAC5B,MAAMK,EAAOC,EAAiB,kBAACN,CAAI,EACnCW,EAAKN,CAAI,CACjB,EAAO,CAAE,MAAO,IAAM,CACtB","x_google_ignoreList":[0,1]}