import{m as $,R as l,L as x,M as F,aF as V,O as _,u as b,o as P,a as S,c as B,H as O,N as T,b as h,Z as A,J as I}from"./rpcWorker-BQYX6MpU.js";const j=$()({block:{display:"block"}});function C({checked:e,disabled:c,label:o,onChange:a}){const{classes:n}=j();return l.createElement(x,{disabled:c,className:n.block,control:l.createElement(F,{checked:e,onChange:a}),label:o})}function H(e){return e.map(({id:c,displays:o,...a})=>({...a,displays:o.map(({id:n,...i})=>i)}))}function D({feature:e,assembly:c}){var o;const a=(o=e.get("ALT"))===null||o===void 0?void 0:o[0],n=a?V(a):void 0,i=e.get("start"),d=e.get("refName"),s=r=>c.getCanonicalRefName(r)||r;if(a==="<TRA>"){const r=e.get("INFO");return{pos:i,refName:s(d),mateRefName:s(r.CHR2[0]),matePos:r.END[0]-1}}else if(n!=null&&n.MatePosition){const r=n.MatePosition.split(":");return{pos:i,refName:s(d),mateRefName:s(r[0]),matePos:+r[1]-1}}else if(e.get("mate")){const r=e.get("mate");return{pos:i,refName:s(d),mateRefName:s(r.refName),matePos:r.start}}else return{pos:i,refName:s(d),mateRefName:s(d),matePos:e.get("end")}}function G({feature:e,session:c,assemblyName:o}){const{assemblyManager:a}=c,n=a.get(o);if(!n)throw new Error(`assembly ${o} not found`);if(!n.regions)throw new Error(`assembly ${o} regions not loaded`);const i=D({feature:e,assembly:n}),{refName:d,mateRefName:s}=i,r=n.regions.find(t=>t.refName===d),f=n.regions.find(t=>t.refName===s);return{coverage:i,snap:{type:"BreakpointSplitView",views:[{type:"LinearGenomeView",displayedRegions:b.gatherOverlaps([{...r,assemblyName:o},{...f,assemblyName:o}])}],displayName:`${e.get("name")||e.get("id")||"breakend"} split detail`}}}async function W({stableViewId:e,feature:c,assemblyName:o,session:a,tracks:n,windowSize:i=0}){var d;const{snap:s,coverage:r}=G({feature:c,assemblyName:o,session:a}),{refName:f,pos:t,mateRefName:v,matePos:k}=r;let g=a.views.find(p=>p.id===e);g?((d=g.views[0])===null||d===void 0||d.setDisplayedRegions(s.views[0].displayedRegions),g.setDisplayName(s.displayName)):g=a.addView("BreakpointSplitView",{...s,views:[{...s.views[0],tracks:n?H(_(n)):[]}]});const m=g.views[0];await b.when(()=>m.initialized);const u=m.bpToPx({coord:Math.max(0,t-i),refName:f}),w=m.bpToPx({coord:k+i,refName:v});u&&w?m.moveTo({...u,offset:u.offsetPx},{...w,offset:w.offsetPx}):b.getSession(m).notify("Unable to navigate to breakpoint")}function R(e){return e.map(({id:c,displays:o,...a})=>({...a,displays:o.map(({id:n,...i})=>i)}))}const z=P(function({session:e,handleClose:c,feature:o,assemblyName:a,stableViewId:n,view:i}){const[d,s]=S.useState(!0),[r,f]=S.useState(!0);return l.createElement(B.Dialog,{open:!0,onClose:c,title:"Multi-level breakpoint split view options"},l.createElement(O,null,l.createElement("div",null,"Launch multi-level breakpoint split view"),i?l.createElement(l.Fragment,null,l.createElement(C,{checked:d,label:"Copy tracks into the new view",onChange:t=>{s(t.target.checked)}}),d?l.createElement(C,{checked:r,disabled:!d,label:"Mirror the copied tracks (only available if copying tracks and using two level)",onChange:t=>{f(t.target.checked)}}):null):null),l.createElement(T,null,l.createElement(h,{onClick:()=>{(async()=>{try{const{assemblyManager:t}=e,v=await t.waitForAssembly(a);if(!v)throw new Error(`assembly ${a} not found`);const{refName:k,pos:g,mateRefName:m,matePos:u}=D({feature:o,assembly:v}),w=i?_(i.tracks):[];let p=e.views.find(y=>y.id===n);const L=`${o.get("name")||o.get("id")||"breakend"} split detail`;p||(p=e.addView("BreakpointSplitView",{id:n,type:"BreakpointSplitView",displayName:L,views:[{type:"LinearGenomeView",hideHeader:!0,tracks:R(w)},{type:"LinearGenomeView",hideHeader:!0,tracks:R(r?[...w].reverse():w)}]})),p.setDisplayName(L);const E=v.regions.find(y=>y.refName===k),N=v.regions.find(y=>y.refName===m);if(!E||!N)throw new Error("can't find regions");await Promise.all([p.views[0].navToLocations([{refName:k,start:E.start,end:g,assemblyName:a},{refName:k,start:g+1,end:E.end,assemblyName:a}]),p.views[1].navToLocations([{refName:m,start:N.start,end:u,assemblyName:a},{refName:m,start:u+1,end:N.end,assemblyName:a}])]),await A(()=>p.views[1].initialized&&p.views[0].initialized),p.views[1].zoomTo(10),p.views[0].zoomTo(10),p.views[1].centerAt(u,m),p.views[0].centerAt(g,k)}catch(t){console.error(t),e.notifyError(`${t}`,t)}})(),c()},variant:"contained",color:"primary",autoFocus:!0},"OK"),l.createElement(h,{color:"secondary",variant:"contained",onClick:()=>{c()}},"Cancel")))}),M=P(function({session:e,handleClose:c,feature:o,stableViewId:a,assemblyName:n,view:i}){const[d,s]=S.useState(!0),[r,f]=b.useLocalStorage("breakpointWindowSize","5000");return l.createElement(B.Dialog,{open:!0,onClose:c,title:"Single-level breakpoint split view options"},l.createElement(O,null,i?l.createElement(C,{checked:d,label:"Copy tracks into the new view",onChange:t=>{s(t.target.checked)}}):null,l.createElement(I,{label:"Window size (bp)",value:r,onChange:t=>{f(t.target.value)}})),l.createElement(T,null,l.createElement(h,{onClick:()=>{(async()=>{try{const{assemblyManager:t}=e;if(!await t.waitForAssembly(n))throw new Error(`assembly ${n} not found`);await W({feature:o,assemblyName:n,session:e,stableViewId:a,tracks:i==null?void 0:i.tracks,windowSize:+r||0})}catch(t){console.error(t),e.notifyError(`${t}`,t)}})(),c()},variant:"contained",color:"primary",autoFocus:!0},"OK"),l.createElement(h,{color:"secondary",variant:"contained",onClick:()=>{c()}},"Cancel")))});var J=Object.freeze({__proto__:null,default:z}),U=Object.freeze({__proto__:null,default:M}),Z=Object.freeze({__proto__:null,default:z}),q=Object.freeze({__proto__:null,default:M});export{J as B,U as a,Z as b,q as c};
//# sourceMappingURL=BreakendSingleLevelOptionDialog-BVv4vkmo.js.map
