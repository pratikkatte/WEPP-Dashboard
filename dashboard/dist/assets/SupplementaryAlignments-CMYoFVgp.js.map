{"version":3,"mappings":"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","names":["getSAFeatures","view","feature","_a","assemblyManager","getSession","cigar","origStrand","SA","readName","clipPos","getClip","assembly","suppAlns","featurizeSA","feat","getLengthSansClipping","features","f","idx","a","b","BreakendMultiLevelOptionDialog","lazy","__vitePreload","n","BreakendSingleLevelOptionDialog","LaunchBreakpointSplitViewPanel","model","res","setRes","useState","error","setError","useEffect","feats","SimpleFeature","e","ret","i","React","Typography","ErrorMessage","arg","index","f1","f2","toLocale","TopBottomSplitViewLink","SideBySideViewLink","Link","event","session","handleClose","SupplementaryAlignmentsLocStrings","tag","saRef","saStart","saStrand","saCigar","saLength","getLengthOnRef","extra","start","end","sp","ep","locString","displayStart","displayEnd","displayString","navToLoc","SupplementaryAlignments","props","pluginManager","getEnv","hasBreakendSplitView","BaseCard"],"ignoreList":[0,1,2,3],"sources":["../../node_modules/@jbrowse/plugin-alignments/esm/AlignmentsFeatureDetail/getSAFeatures.js","../../node_modules/@jbrowse/plugin-alignments/esm/AlignmentsFeatureDetail/LaunchSupplementaryAlignmentBreakpointSplitViewPanel.js","../../node_modules/@jbrowse/plugin-alignments/esm/AlignmentsFeatureDetail/SupplementaryAlignmentsLocStrings.js","../../node_modules/@jbrowse/plugin-alignments/esm/AlignmentsFeatureDetail/SupplementaryAlignments.js"],"sourcesContent":["import { getSession } from '@jbrowse/core/util';\nimport { featurizeSA, getClip, getLengthSansClipping } from '../MismatchParser';\nexport async function getSAFeatures({ view, feature, }) {\n    var _a;\n    const { assemblyManager } = getSession(view);\n    const cigar = feature.get('CIGAR');\n    const origStrand = feature.get('strand');\n    const SA = ((_a = feature.get('tags')) === null || _a === void 0 ? void 0 : _a.SA) || '';\n    const readName = feature.get('name');\n    const clipPos = getClip(cigar, 1);\n    const assembly = await assemblyManager.waitForAssembly(view.assemblyNames[0]);\n    if (!assembly) {\n        throw new Error('assembly not found');\n    }\n    const suppAlns = featurizeSA(SA, feature.id(), origStrand, readName, true);\n    const feat = feature.toJSON();\n    feat.clipPos = clipPos;\n    feat.strand = 1;\n    feat.mate = {\n        refName: readName,\n        start: clipPos,\n        end: clipPos + getLengthSansClipping(cigar),\n    };\n    const features = [feat, ...suppAlns];\n    features.forEach((f, idx) => {\n        f.refName = assembly.getCanonicalRefName(f.refName) || f.refName;\n        f.syntenyId = idx;\n        f.mate.syntenyId = idx;\n        f.mate.uniqueId = `${f.uniqueId}_mate`;\n    });\n    features.sort((a, b) => a.clipPos - b.clipPos);\n    return features;\n}\n","import React, { lazy, useEffect, useState } from 'react';\nimport { ErrorMessage } from '@jbrowse/core/ui';\nimport { SimpleFeature, getSession, toLocale } from '@jbrowse/core/util';\nimport { Link, Typography } from '@mui/material';\nimport { getSAFeatures } from './getSAFeatures';\nconst BreakendMultiLevelOptionDialog = lazy(() => import('./BreakendMultiLevelOptionDialog'));\nconst BreakendSingleLevelOptionDialog = lazy(() => import('./BreakendSingleLevelOptionDialog'));\nexport default function LaunchBreakpointSplitViewPanel({ model, feature, }) {\n    const { view } = model;\n    const [res, setRes] = useState();\n    const [error, setError] = useState();\n    useEffect(() => {\n        ;\n        (async () => {\n            try {\n                const feats = await getSAFeatures({\n                    view,\n                    feature: new SimpleFeature(feature),\n                });\n                setRes(feats);\n            }\n            catch (e) {\n                setError(e);\n                console.error(e);\n            }\n        })();\n    }, [feature, view]);\n    const ret = [];\n    if (res) {\n        for (let i = 0; i < res.length - 1; i++) {\n            ret.push([res[i], res[i + 1]]);\n        }\n    }\n    return ret.length ? (React.createElement(\"div\", null,\n        React.createElement(Typography, null, \"Launch split view\"),\n        error ? React.createElement(ErrorMessage, { error: error }) : null,\n        React.createElement(\"ul\", null, ret.map((arg, index) => {\n            const [f1, f2] = arg;\n            return (React.createElement(\"li\", { key: `${JSON.stringify(arg)}-${index}` },\n                f1.refName,\n                \":\",\n                toLocale(f1.strand === 1 ? f1.end : f1.start),\n                \" ->\",\n                ' ',\n                f2.refName,\n                \":\",\n                toLocale(f2.strand === 1 ? f2.start : f2.end),\n                ' ',\n                React.createElement(TopBottomSplitViewLink, { model: model, f1: f1, f2: f2 }),\n                ' ',\n                React.createElement(SideBySideViewLink, { model: model, f1: f1, f2: f2 })));\n        })))) : null;\n}\nfunction TopBottomSplitViewLink({ model, f1, f2, }) {\n    return (React.createElement(Link, { href: \"#\", onClick: event => {\n            event.preventDefault();\n            const session = getSession(model);\n            session.queueDialog(handleClose => [\n                BreakendMultiLevelOptionDialog,\n                {\n                    handleClose,\n                    session,\n                    feature: new SimpleFeature({ ...f1, mate: f2 }),\n                    view: model.view,\n                    assemblyName: model.view.displayedRegions[0].assemblyName,\n                },\n            ]);\n        } }, \"(top/bottom)\"));\n}\nfunction SideBySideViewLink({ model, f1, f2, }) {\n    return (React.createElement(Link, { href: \"#\", onClick: event => {\n            event.preventDefault();\n            const session = getSession(model);\n            session.queueDialog(handleClose => [\n                BreakendSingleLevelOptionDialog,\n                {\n                    handleClose,\n                    session,\n                    feature: new SimpleFeature({ ...f1, mate: f2 }),\n                    view: model.view,\n                    assemblyName: model.view.displayedRegions[0].assemblyName,\n                },\n            ]);\n        } }, \"(single row)\"));\n}\n","import React from 'react';\nimport { Link, Typography } from '@mui/material';\nimport { getLengthOnRef } from '../MismatchParser';\nimport { navToLoc } from './util';\nexport default function SupplementaryAlignmentsLocStrings({ tag, model, }) {\n    return (React.createElement(\"div\", null,\n        React.createElement(Typography, null, \"List of supplementary alignment locations\"),\n        React.createElement(\"ul\", null, tag\n            .split(';')\n            .filter(SA => !!SA)\n            .map((SA, idx) => {\n            const [saRef, saStart, saStrand, saCigar] = SA.split(',');\n            const saLength = getLengthOnRef(saCigar);\n            const extra = Math.floor(saLength / 5);\n            const start = +saStart;\n            const end = +saStart + saLength;\n            const sp = start - extra;\n            const ep = end + extra;\n            const locString = `${saRef}:${Math.max(1, sp)}-${ep}`;\n            const displayStart = start.toLocaleString('en-US');\n            const displayEnd = end.toLocaleString('en-US');\n            const displayString = `${saRef}:${displayStart}-${displayEnd} (${saStrand}) [${saLength}bp]`;\n            return (React.createElement(\"li\", { key: `${locString}-${idx}` },\n                React.createElement(Link, { href: \"#\", onClick: async (event) => {\n                        event.preventDefault();\n                        navToLoc(locString, model);\n                    } }, displayString)));\n        }))));\n}\n","import React from 'react';\nimport BaseCard from '@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail/BaseCard';\nimport { getEnv, getSession } from '@jbrowse/core/util';\nimport LaunchBreakpointSplitViewPanel from './LaunchSupplementaryAlignmentBreakpointSplitViewPanel';\nimport SupplementaryAlignmentsLocStrings from './SupplementaryAlignmentsLocStrings';\nexport default function SupplementaryAlignments(props) {\n    const { model, tag, feature } = props;\n    const session = getSession(model);\n    const { pluginManager } = getEnv(session);\n    let hasBreakendSplitView = false;\n    try {\n        hasBreakendSplitView = !!pluginManager.getViewType('BreakpointSplitView');\n    }\n    catch (e) {\n    }\n    return (React.createElement(BaseCard, { ...props, title: \"Supplementary alignments\" },\n        React.createElement(SupplementaryAlignmentsLocStrings, { model: model, tag: tag }),\n        hasBreakendSplitView ? (React.createElement(LaunchBreakpointSplitViewPanel, { model: model, feature: feature })) : null));\n}\n"],"file":"assets/SupplementaryAlignments-CMYoFVgp.js"}