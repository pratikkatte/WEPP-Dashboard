import{aV as wt,aW as bt,aN as Q,bH as xt,a_ as _t,aa as mt,ab as kt}from"./index-CTn4VqQ6.js";import{O as pt}from"./Observable-CD35oR4t.js";const Qe=BigInt(32);function yt(n,t,e){const s=+!!e,r=+!e;return BigInt(n.getInt32(t,e)*r+n.getInt32(t+4,e)*s)<<Qe|BigInt(n.getUint32(t,e)*s+n.getUint32(t+4,e)*r)}function Et(n,t,e){const s=n.getUint32(t,e),r=n.getUint32(t+4,e),i=+!!e,l=+!e;return BigInt(s*l+r*i)<<Qe|BigInt(s*i+r*l)}"getBigInt64"in DataView||(DataView.prototype.getBigInt64=function(n,t){return yt(this,n,t)});"getBigUint64"in DataView||(DataView.prototype.getBigUint64=function(n,t){return Et(this,n,t)});class z{constructor(t){this.ranges=t}get min(){return this.ranges[0].min}get max(){return this.ranges.at(-1).max}contains(t){for(const e of this.ranges)if(e.min<=t&&e.max>=t)return!0;return!1}isContiguous(){return this.ranges.length>1}getRanges(){return this.ranges.map(t=>new z([{min:t.min,max:t.max}]))}toString(){return this.ranges.map(t=>`[${t.min}-${t.max}]`).join(",")}union(t){const e=[...this.getRanges(),...t.getRanges()].sort((i,l)=>i.min<l.min?-1:i.min>l.min?1:i.max<l.max?-1:l.max>i.max?1:0),s=[];let r=e[0];for(const i of e)i.min>r.max+1?(s.push(r),r=i):i.max>r.max&&(r=new z([{min:r.min,max:i.max}]));return s.push(r),s.length===1?s[0]:new z(s)}}function H(n){let t=n.length;for(;--t>=0;)n[t]=0}const vt=3,Bt=258,Je=29,St=256,Rt=St+1+Je,qe=30,Ut=512,At=new Array((Rt+2)*2);H(At);const Dt=new Array(qe*2);H(Dt);const It=new Array(Ut);H(It);const Tt=new Array(Bt-vt+1);H(Tt);const Ot=new Array(Je);H(Ot);const Nt=new Array(qe);H(Nt);const Ct=(n,t,e,s)=>{let r=n&65535|0,i=n>>>16&65535|0,l=0;for(;e!==0;){l=e>2e3?2e3:e,e-=l;do r=r+t[s++]|0,i=i+r|0;while(--l);r%=65521,i%=65521}return r|i<<16|0};var xe=Ct;const Ft=()=>{let n,t=[];for(var e=0;e<256;e++){n=e;for(var s=0;s<8;s++)n=n&1?3988292384^n>>>1:n>>>1;t[e]=n}return t},Mt=new Uint32Array(Ft()),Zt=(n,t,e,s)=>{const r=Mt,i=s+e;n^=-1;for(let l=s;l<i;l++)n=n>>>8^r[(n^t[l])&255];return n^-1};var O=Zt,_e={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},et={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const Lt=(n,t)=>Object.prototype.hasOwnProperty.call(n,t);var $t=function(n){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const e=t.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const s in e)Lt(e,s)&&(n[s]=e[s])}}return n},zt=n=>{let t=0;for(let s=0,r=n.length;s<r;s++)t+=n[s].length;const e=new Uint8Array(t);for(let s=0,r=0,i=n.length;s<i;s++){let l=n[s];e.set(l,r),r+=l.length}return e},tt={assign:$t,flattenChunks:zt};let nt=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{nt=!1}const P=new Uint8Array(256);for(let n=0;n<256;n++)P[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;P[254]=P[254]=1;var Ht=n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let t,e,s,r,i,l=n.length,f=0;for(r=0;r<l;r++)e=n.charCodeAt(r),(e&64512)===55296&&r+1<l&&(s=n.charCodeAt(r+1),(s&64512)===56320&&(e=65536+(e-55296<<10)+(s-56320),r++)),f+=e<128?1:e<2048?2:e<65536?3:4;for(t=new Uint8Array(f),i=0,r=0;i<f;r++)e=n.charCodeAt(r),(e&64512)===55296&&r+1<l&&(s=n.charCodeAt(r+1),(s&64512)===56320&&(e=65536+(e-55296<<10)+(s-56320),r++)),e<128?t[i++]=e:e<2048?(t[i++]=192|e>>>6,t[i++]=128|e&63):e<65536?(t[i++]=224|e>>>12,t[i++]=128|e>>>6&63,t[i++]=128|e&63):(t[i++]=240|e>>>18,t[i++]=128|e>>>12&63,t[i++]=128|e>>>6&63,t[i++]=128|e&63);return t};const Vt=(n,t)=>{if(t<65534&&n.subarray&&nt)return String.fromCharCode.apply(null,n.length===t?n:n.subarray(0,t));let e="";for(let s=0;s<t;s++)e+=String.fromCharCode(n[s]);return e};var Pt=(n,t)=>{const e=t||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,t));let s,r;const i=new Array(e*2);for(r=0,s=0;s<e;){let l=n[s++];if(l<128){i[r++]=l;continue}let f=P[l];if(f>4){i[r++]=65533,s+=f-1;continue}for(l&=f===2?31:f===3?15:7;f>1&&s<e;)l=l<<6|n[s++]&63,f--;if(f>1){i[r++]=65533;continue}l<65536?i[r++]=l:(l-=65536,i[r++]=55296|l>>10&1023,i[r++]=56320|l&1023)}return Vt(i,r)},Gt=(n,t)=>{t=t||n.length,t>n.length&&(t=n.length);let e=t-1;for(;e>=0&&(n[e]&192)===128;)e--;return e<0||e===0?t:e+P[n[e]]>t?e:t},me={string2buf:Ht,buf2string:Pt,utf8border:Gt};function Kt(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Wt=Kt;const K=16209,jt=16191;var Xt=function(t,e){let s,r,i,l,f,h,a,o,v,x,c,b,B,m,y,k,S,d,p,R,g,E,_,w;const u=t.state;s=t.next_in,_=t.input,r=s+(t.avail_in-5),i=t.next_out,w=t.output,l=i-(e-t.avail_out),f=i+(t.avail_out-257),h=u.dmax,a=u.wsize,o=u.whave,v=u.wnext,x=u.window,c=u.hold,b=u.bits,B=u.lencode,m=u.distcode,y=(1<<u.lenbits)-1,k=(1<<u.distbits)-1;e:do{b<15&&(c+=_[s++]<<b,b+=8,c+=_[s++]<<b,b+=8),S=B[c&y];t:for(;;){if(d=S>>>24,c>>>=d,b-=d,d=S>>>16&255,d===0)w[i++]=S&65535;else if(d&16){p=S&65535,d&=15,d&&(b<d&&(c+=_[s++]<<b,b+=8),p+=c&(1<<d)-1,c>>>=d,b-=d),b<15&&(c+=_[s++]<<b,b+=8,c+=_[s++]<<b,b+=8),S=m[c&k];n:for(;;){if(d=S>>>24,c>>>=d,b-=d,d=S>>>16&255,d&16){if(R=S&65535,d&=15,b<d&&(c+=_[s++]<<b,b+=8,b<d&&(c+=_[s++]<<b,b+=8)),R+=c&(1<<d)-1,R>h){t.msg="invalid distance too far back",u.mode=K;break e}if(c>>>=d,b-=d,d=i-l,R>d){if(d=R-d,d>o&&u.sane){t.msg="invalid distance too far back",u.mode=K;break e}if(g=0,E=x,v===0){if(g+=a-d,d<p){p-=d;do w[i++]=x[g++];while(--d);g=i-R,E=w}}else if(v<d){if(g+=a+v-d,d-=v,d<p){p-=d;do w[i++]=x[g++];while(--d);if(g=0,v<p){d=v,p-=d;do w[i++]=x[g++];while(--d);g=i-R,E=w}}}else if(g+=v-d,d<p){p-=d;do w[i++]=x[g++];while(--d);g=i-R,E=w}for(;p>2;)w[i++]=E[g++],w[i++]=E[g++],w[i++]=E[g++],p-=3;p&&(w[i++]=E[g++],p>1&&(w[i++]=E[g++]))}else{g=i-R;do w[i++]=w[g++],w[i++]=w[g++],w[i++]=w[g++],p-=3;while(p>2);p&&(w[i++]=w[g++],p>1&&(w[i++]=w[g++]))}}else if((d&64)===0){S=m[(S&65535)+(c&(1<<d)-1)];continue n}else{t.msg="invalid distance code",u.mode=K;break e}break}}else if((d&64)===0){S=B[(S&65535)+(c&(1<<d)-1)];continue t}else if(d&32){u.mode=jt;break e}else{t.msg="invalid literal/length code",u.mode=K;break e}break}}while(s<r&&i<f);p=b>>3,s-=p,b-=p<<3,c&=(1<<b)-1,t.next_in=s,t.next_out=i,t.avail_in=s<r?5+(r-s):5-(s-r),t.avail_out=i<f?257+(f-i):257-(i-f),u.hold=c,u.bits=b};const $=15,ke=852,pe=592,ye=0,oe=1,Ee=2,Yt=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Qt=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Jt=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),qt=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),en=(n,t,e,s,r,i,l,f)=>{const h=f.bits;let a=0,o=0,v=0,x=0,c=0,b=0,B=0,m=0,y=0,k=0,S,d,p,R,g,E=null,_;const w=new Uint16Array($+1),u=new Uint16Array($+1);let D=null,M,I,A;for(a=0;a<=$;a++)w[a]=0;for(o=0;o<s;o++)w[t[e+o]]++;for(c=h,x=$;x>=1&&w[x]===0;x--);if(c>x&&(c=x),x===0)return r[i++]=1<<24|64<<16|0,r[i++]=1<<24|64<<16|0,f.bits=1,0;for(v=1;v<x&&w[v]===0;v++);for(c<v&&(c=v),m=1,a=1;a<=$;a++)if(m<<=1,m-=w[a],m<0)return-1;if(m>0&&(n===ye||x!==1))return-1;for(u[1]=0,a=1;a<$;a++)u[a+1]=u[a]+w[a];for(o=0;o<s;o++)t[e+o]!==0&&(l[u[t[e+o]]++]=o);if(n===ye?(E=D=l,_=20):n===oe?(E=Yt,D=Qt,_=257):(E=Jt,D=qt,_=0),k=0,o=0,a=v,g=i,b=c,B=0,p=-1,y=1<<c,R=y-1,n===oe&&y>ke||n===Ee&&y>pe)return 1;for(;;){M=a-B,l[o]+1<_?(I=0,A=l[o]):l[o]>=_?(I=D[l[o]-_],A=E[l[o]-_]):(I=96,A=0),S=1<<a-B,d=1<<b,v=d;do d-=S,r[g+(k>>B)+d]=M<<24|I<<16|A|0;while(d!==0);for(S=1<<a-1;k&S;)S>>=1;if(S!==0?(k&=S-1,k+=S):k=0,o++,--w[a]===0){if(a===x)break;a=t[e+l[o]]}if(a>c&&(k&R)!==p){for(B===0&&(B=c),g+=v,b=a-B,m=1<<b;b+B<x&&(m-=w[b+B],!(m<=0));)b++,m<<=1;if(y+=1<<b,n===oe&&y>ke||n===Ee&&y>pe)return 1;p=k&R,r[p]=c<<24|b<<16|g-i|0}}return k!==0&&(r[g+k]=a-B<<24|64<<16|0),f.bits=c,0};var V=en;const tn=0,it=1,at=2,{Z_FINISH:ve,Z_BLOCK:nn,Z_TREES:W,Z_OK:Z,Z_STREAM_END:an,Z_NEED_DICT:sn,Z_STREAM_ERROR:T,Z_DATA_ERROR:st,Z_MEM_ERROR:ot,Z_BUF_ERROR:on,Z_DEFLATED:Be}=et,q=16180,Se=16181,Re=16182,Ue=16183,Ae=16184,De=16185,Ie=16186,Te=16187,Oe=16188,Ne=16189,J=16190,N=16191,re=16192,Ce=16193,fe=16194,Fe=16195,Me=16196,Ze=16197,Le=16198,j=16199,X=16200,$e=16201,ze=16202,He=16203,Ve=16204,Pe=16205,le=16206,Ge=16207,Ke=16208,U=16209,rt=16210,ft=16211,rn=852,fn=592,ln=15,cn=ln,We=n=>(n>>>24&255)+(n>>>8&65280)+((n&65280)<<8)+((n&255)<<24);function hn(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const L=n=>{if(!n)return 1;const t=n.state;return!t||t.strm!==n||t.mode<q||t.mode>ft?1:0},lt=n=>{if(L(n))return T;const t=n.state;return n.total_in=n.total_out=t.total=0,n.msg="",t.wrap&&(n.adler=t.wrap&1),t.mode=q,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(rn),t.distcode=t.distdyn=new Int32Array(fn),t.sane=1,t.back=-1,Z},ct=n=>{if(L(n))return T;const t=n.state;return t.wsize=0,t.whave=0,t.wnext=0,lt(n)},ht=(n,t)=>{let e;if(L(n))return T;const s=n.state;return t<0?(e=0,t=-t):(e=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?T:(s.window!==null&&s.wbits!==t&&(s.window=null),s.wrap=e,s.wbits=t,ct(n))},dt=(n,t)=>{if(!n)return T;const e=new hn;n.state=e,e.strm=n,e.window=null,e.mode=q;const s=ht(n,t);return s!==Z&&(n.state=null),s},dn=n=>dt(n,cn);let je=!0,ce,he;const un=n=>{if(je){ce=new Int32Array(512),he=new Int32Array(32);let t=0;for(;t<144;)n.lens[t++]=8;for(;t<256;)n.lens[t++]=9;for(;t<280;)n.lens[t++]=7;for(;t<288;)n.lens[t++]=8;for(V(it,n.lens,0,288,ce,0,n.work,{bits:9}),t=0;t<32;)n.lens[t++]=5;V(at,n.lens,0,32,he,0,n.work,{bits:5}),je=!1}n.lencode=ce,n.lenbits=9,n.distcode=he,n.distbits=5},ut=(n,t,e,s)=>{let r;const i=n.state;return i.window===null&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),s>=i.wsize?(i.window.set(t.subarray(e-i.wsize,e),0),i.wnext=0,i.whave=i.wsize):(r=i.wsize-i.wnext,r>s&&(r=s),i.window.set(t.subarray(e-s,e-s+r),i.wnext),s-=r,s?(i.window.set(t.subarray(e-s,e),0),i.wnext=s,i.whave=i.wsize):(i.wnext+=r,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=r))),0},gn=(n,t)=>{let e,s,r,i,l,f,h,a,o,v,x,c,b,B,m=0,y,k,S,d,p,R,g,E;const _=new Uint8Array(4);let w,u;const D=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(L(n)||!n.output||!n.input&&n.avail_in!==0)return T;e=n.state,e.mode===N&&(e.mode=re),l=n.next_out,r=n.output,h=n.avail_out,i=n.next_in,s=n.input,f=n.avail_in,a=e.hold,o=e.bits,v=f,x=h,E=Z;e:for(;;)switch(e.mode){case q:if(e.wrap===0){e.mode=re;break}for(;o<16;){if(f===0)break e;f--,a+=s[i++]<<o,o+=8}if(e.wrap&2&&a===35615){e.wbits===0&&(e.wbits=15),e.check=0,_[0]=a&255,_[1]=a>>>8&255,e.check=O(e.check,_,2,0),a=0,o=0,e.mode=Se;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((a&255)<<8)+(a>>8))%31){n.msg="incorrect header check",e.mode=U;break}if((a&15)!==Be){n.msg="unknown compression method",e.mode=U;break}if(a>>>=4,o-=4,g=(a&15)+8,e.wbits===0&&(e.wbits=g),g>15||g>e.wbits){n.msg="invalid window size",e.mode=U;break}e.dmax=1<<e.wbits,e.flags=0,n.adler=e.check=1,e.mode=a&512?Ne:N,a=0,o=0;break;case Se:for(;o<16;){if(f===0)break e;f--,a+=s[i++]<<o,o+=8}if(e.flags=a,(e.flags&255)!==Be){n.msg="unknown compression method",e.mode=U;break}if(e.flags&57344){n.msg="unknown header flags set",e.mode=U;break}e.head&&(e.head.text=a>>8&1),e.flags&512&&e.wrap&4&&(_[0]=a&255,_[1]=a>>>8&255,e.check=O(e.check,_,2,0)),a=0,o=0,e.mode=Re;case Re:for(;o<32;){if(f===0)break e;f--,a+=s[i++]<<o,o+=8}e.head&&(e.head.time=a),e.flags&512&&e.wrap&4&&(_[0]=a&255,_[1]=a>>>8&255,_[2]=a>>>16&255,_[3]=a>>>24&255,e.check=O(e.check,_,4,0)),a=0,o=0,e.mode=Ue;case Ue:for(;o<16;){if(f===0)break e;f--,a+=s[i++]<<o,o+=8}e.head&&(e.head.xflags=a&255,e.head.os=a>>8),e.flags&512&&e.wrap&4&&(_[0]=a&255,_[1]=a>>>8&255,e.check=O(e.check,_,2,0)),a=0,o=0,e.mode=Ae;case Ae:if(e.flags&1024){for(;o<16;){if(f===0)break e;f--,a+=s[i++]<<o,o+=8}e.length=a,e.head&&(e.head.extra_len=a),e.flags&512&&e.wrap&4&&(_[0]=a&255,_[1]=a>>>8&255,e.check=O(e.check,_,2,0)),a=0,o=0}else e.head&&(e.head.extra=null);e.mode=De;case De:if(e.flags&1024&&(c=e.length,c>f&&(c=f),c&&(e.head&&(g=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(s.subarray(i,i+c),g)),e.flags&512&&e.wrap&4&&(e.check=O(e.check,s,c,i)),f-=c,i+=c,e.length-=c),e.length))break e;e.length=0,e.mode=Ie;case Ie:if(e.flags&2048){if(f===0)break e;c=0;do g=s[i+c++],e.head&&g&&e.length<65536&&(e.head.name+=String.fromCharCode(g));while(g&&c<f);if(e.flags&512&&e.wrap&4&&(e.check=O(e.check,s,c,i)),f-=c,i+=c,g)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=Te;case Te:if(e.flags&4096){if(f===0)break e;c=0;do g=s[i+c++],e.head&&g&&e.length<65536&&(e.head.comment+=String.fromCharCode(g));while(g&&c<f);if(e.flags&512&&e.wrap&4&&(e.check=O(e.check,s,c,i)),f-=c,i+=c,g)break e}else e.head&&(e.head.comment=null);e.mode=Oe;case Oe:if(e.flags&512){for(;o<16;){if(f===0)break e;f--,a+=s[i++]<<o,o+=8}if(e.wrap&4&&a!==(e.check&65535)){n.msg="header crc mismatch",e.mode=U;break}a=0,o=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),n.adler=e.check=0,e.mode=N;break;case Ne:for(;o<32;){if(f===0)break e;f--,a+=s[i++]<<o,o+=8}n.adler=e.check=We(a),a=0,o=0,e.mode=J;case J:if(e.havedict===0)return n.next_out=l,n.avail_out=h,n.next_in=i,n.avail_in=f,e.hold=a,e.bits=o,sn;n.adler=e.check=1,e.mode=N;case N:if(t===nn||t===W)break e;case re:if(e.last){a>>>=o&7,o-=o&7,e.mode=le;break}for(;o<3;){if(f===0)break e;f--,a+=s[i++]<<o,o+=8}switch(e.last=a&1,a>>>=1,o-=1,a&3){case 0:e.mode=Ce;break;case 1:if(un(e),e.mode=j,t===W){a>>>=2,o-=2;break e}break;case 2:e.mode=Me;break;case 3:n.msg="invalid block type",e.mode=U}a>>>=2,o-=2;break;case Ce:for(a>>>=o&7,o-=o&7;o<32;){if(f===0)break e;f--,a+=s[i++]<<o,o+=8}if((a&65535)!==(a>>>16^65535)){n.msg="invalid stored block lengths",e.mode=U;break}if(e.length=a&65535,a=0,o=0,e.mode=fe,t===W)break e;case fe:e.mode=Fe;case Fe:if(c=e.length,c){if(c>f&&(c=f),c>h&&(c=h),c===0)break e;r.set(s.subarray(i,i+c),l),f-=c,i+=c,h-=c,l+=c,e.length-=c;break}e.mode=N;break;case Me:for(;o<14;){if(f===0)break e;f--,a+=s[i++]<<o,o+=8}if(e.nlen=(a&31)+257,a>>>=5,o-=5,e.ndist=(a&31)+1,a>>>=5,o-=5,e.ncode=(a&15)+4,a>>>=4,o-=4,e.nlen>286||e.ndist>30){n.msg="too many length or distance symbols",e.mode=U;break}e.have=0,e.mode=Ze;case Ze:for(;e.have<e.ncode;){for(;o<3;){if(f===0)break e;f--,a+=s[i++]<<o,o+=8}e.lens[D[e.have++]]=a&7,a>>>=3,o-=3}for(;e.have<19;)e.lens[D[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,w={bits:e.lenbits},E=V(tn,e.lens,0,19,e.lencode,0,e.work,w),e.lenbits=w.bits,E){n.msg="invalid code lengths set",e.mode=U;break}e.have=0,e.mode=Le;case Le:for(;e.have<e.nlen+e.ndist;){for(;m=e.lencode[a&(1<<e.lenbits)-1],y=m>>>24,k=m>>>16&255,S=m&65535,!(y<=o);){if(f===0)break e;f--,a+=s[i++]<<o,o+=8}if(S<16)a>>>=y,o-=y,e.lens[e.have++]=S;else{if(S===16){for(u=y+2;o<u;){if(f===0)break e;f--,a+=s[i++]<<o,o+=8}if(a>>>=y,o-=y,e.have===0){n.msg="invalid bit length repeat",e.mode=U;break}g=e.lens[e.have-1],c=3+(a&3),a>>>=2,o-=2}else if(S===17){for(u=y+3;o<u;){if(f===0)break e;f--,a+=s[i++]<<o,o+=8}a>>>=y,o-=y,g=0,c=3+(a&7),a>>>=3,o-=3}else{for(u=y+7;o<u;){if(f===0)break e;f--,a+=s[i++]<<o,o+=8}a>>>=y,o-=y,g=0,c=11+(a&127),a>>>=7,o-=7}if(e.have+c>e.nlen+e.ndist){n.msg="invalid bit length repeat",e.mode=U;break}for(;c--;)e.lens[e.have++]=g}}if(e.mode===U)break;if(e.lens[256]===0){n.msg="invalid code -- missing end-of-block",e.mode=U;break}if(e.lenbits=9,w={bits:e.lenbits},E=V(it,e.lens,0,e.nlen,e.lencode,0,e.work,w),e.lenbits=w.bits,E){n.msg="invalid literal/lengths set",e.mode=U;break}if(e.distbits=6,e.distcode=e.distdyn,w={bits:e.distbits},E=V(at,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,w),e.distbits=w.bits,E){n.msg="invalid distances set",e.mode=U;break}if(e.mode=j,t===W)break e;case j:e.mode=X;case X:if(f>=6&&h>=258){n.next_out=l,n.avail_out=h,n.next_in=i,n.avail_in=f,e.hold=a,e.bits=o,Xt(n,x),l=n.next_out,r=n.output,h=n.avail_out,i=n.next_in,s=n.input,f=n.avail_in,a=e.hold,o=e.bits,e.mode===N&&(e.back=-1);break}for(e.back=0;m=e.lencode[a&(1<<e.lenbits)-1],y=m>>>24,k=m>>>16&255,S=m&65535,!(y<=o);){if(f===0)break e;f--,a+=s[i++]<<o,o+=8}if(k&&(k&240)===0){for(d=y,p=k,R=S;m=e.lencode[R+((a&(1<<d+p)-1)>>d)],y=m>>>24,k=m>>>16&255,S=m&65535,!(d+y<=o);){if(f===0)break e;f--,a+=s[i++]<<o,o+=8}a>>>=d,o-=d,e.back+=d}if(a>>>=y,o-=y,e.back+=y,e.length=S,k===0){e.mode=Pe;break}if(k&32){e.back=-1,e.mode=N;break}if(k&64){n.msg="invalid literal/length code",e.mode=U;break}e.extra=k&15,e.mode=$e;case $e:if(e.extra){for(u=e.extra;o<u;){if(f===0)break e;f--,a+=s[i++]<<o,o+=8}e.length+=a&(1<<e.extra)-1,a>>>=e.extra,o-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=ze;case ze:for(;m=e.distcode[a&(1<<e.distbits)-1],y=m>>>24,k=m>>>16&255,S=m&65535,!(y<=o);){if(f===0)break e;f--,a+=s[i++]<<o,o+=8}if((k&240)===0){for(d=y,p=k,R=S;m=e.distcode[R+((a&(1<<d+p)-1)>>d)],y=m>>>24,k=m>>>16&255,S=m&65535,!(d+y<=o);){if(f===0)break e;f--,a+=s[i++]<<o,o+=8}a>>>=d,o-=d,e.back+=d}if(a>>>=y,o-=y,e.back+=y,k&64){n.msg="invalid distance code",e.mode=U;break}e.offset=S,e.extra=k&15,e.mode=He;case He:if(e.extra){for(u=e.extra;o<u;){if(f===0)break e;f--,a+=s[i++]<<o,o+=8}e.offset+=a&(1<<e.extra)-1,a>>>=e.extra,o-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){n.msg="invalid distance too far back",e.mode=U;break}e.mode=Ve;case Ve:if(h===0)break e;if(c=x-h,e.offset>c){if(c=e.offset-c,c>e.whave&&e.sane){n.msg="invalid distance too far back",e.mode=U;break}c>e.wnext?(c-=e.wnext,b=e.wsize-c):b=e.wnext-c,c>e.length&&(c=e.length),B=e.window}else B=r,b=l-e.offset,c=e.length;c>h&&(c=h),h-=c,e.length-=c;do r[l++]=B[b++];while(--c);e.length===0&&(e.mode=X);break;case Pe:if(h===0)break e;r[l++]=e.length,h--,e.mode=X;break;case le:if(e.wrap){for(;o<32;){if(f===0)break e;f--,a|=s[i++]<<o,o+=8}if(x-=h,n.total_out+=x,e.total+=x,e.wrap&4&&x&&(n.adler=e.check=e.flags?O(e.check,r,x,l-x):xe(e.check,r,x,l-x)),x=h,e.wrap&4&&(e.flags?a:We(a))!==e.check){n.msg="incorrect data check",e.mode=U;break}a=0,o=0}e.mode=Ge;case Ge:if(e.wrap&&e.flags){for(;o<32;){if(f===0)break e;f--,a+=s[i++]<<o,o+=8}if(e.wrap&4&&a!==(e.total&4294967295)){n.msg="incorrect length check",e.mode=U;break}a=0,o=0}e.mode=Ke;case Ke:E=an;break e;case U:E=st;break e;case rt:return ot;case ft:default:return T}return n.next_out=l,n.avail_out=h,n.next_in=i,n.avail_in=f,e.hold=a,e.bits=o,(e.wsize||x!==n.avail_out&&e.mode<U&&(e.mode<le||t!==ve))&&ut(n,n.output,n.next_out,x-n.avail_out),v-=n.avail_in,x-=n.avail_out,n.total_in+=v,n.total_out+=x,e.total+=x,e.wrap&4&&x&&(n.adler=e.check=e.flags?O(e.check,r,x,n.next_out-x):xe(e.check,r,x,n.next_out-x)),n.data_type=e.bits+(e.last?64:0)+(e.mode===N?128:0)+(e.mode===j||e.mode===fe?256:0),(v===0&&x===0||t===ve)&&E===Z&&(E=on),E},wn=n=>{if(L(n))return T;let t=n.state;return t.window&&(t.window=null),n.state=null,Z},bn=(n,t)=>{if(L(n))return T;const e=n.state;return(e.wrap&2)===0?T:(e.head=t,t.done=!1,Z)},xn=(n,t)=>{const e=t.length;let s,r,i;return L(n)||(s=n.state,s.wrap!==0&&s.mode!==J)?T:s.mode===J&&(r=1,r=xe(r,t,e,0),r!==s.check)?st:(i=ut(n,t,e,e),i?(s.mode=rt,ot):(s.havedict=1,Z))};var _n=ct,mn=ht,kn=lt,pn=dn,yn=dt,En=gn,vn=wn,Bn=bn,Sn=xn,Rn="pako inflate (from Nodeca project)",C={inflateReset:_n,inflateReset2:mn,inflateResetKeep:kn,inflateInit:pn,inflateInit2:yn,inflate:En,inflateEnd:vn,inflateGetHeader:Bn,inflateSetDictionary:Sn,inflateInfo:Rn};function Un(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var An=Un;const gt=Object.prototype.toString,{Z_NO_FLUSH:Dn,Z_FINISH:In,Z_OK:G,Z_STREAM_END:de,Z_NEED_DICT:ue,Z_STREAM_ERROR:Tn,Z_DATA_ERROR:Xe,Z_MEM_ERROR:On}=et;function ee(n){this.options=tt.assign({chunkSize:1024*64,windowBits:15,to:""},n||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(n&&n.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15)===0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Wt,this.strm.avail_out=0;let e=C.inflateInit2(this.strm,t.windowBits);if(e!==G)throw new Error(_e[e]);if(this.header=new An,C.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=me.string2buf(t.dictionary):gt.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=C.inflateSetDictionary(this.strm,t.dictionary),e!==G)))throw new Error(_e[e])}ee.prototype.push=function(n,t){const e=this.strm,s=this.options.chunkSize,r=this.options.dictionary;let i,l,f;if(this.ended)return!1;for(t===~~t?l=t:l=t===!0?In:Dn,gt.call(n)==="[object ArrayBuffer]"?e.input=new Uint8Array(n):e.input=n,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(s),e.next_out=0,e.avail_out=s),i=C.inflate(e,l),i===ue&&r&&(i=C.inflateSetDictionary(e,r),i===G?i=C.inflate(e,l):i===Xe&&(i=ue));e.avail_in>0&&i===de&&e.state.wrap>0&&n[e.next_in]!==0;)C.inflateReset(e),i=C.inflate(e,l);switch(i){case Tn:case Xe:case ue:case On:return this.onEnd(i),this.ended=!0,!1}if(f=e.avail_out,e.next_out&&(e.avail_out===0||i===de))if(this.options.to==="string"){let h=me.utf8border(e.output,e.next_out),a=e.next_out-h,o=me.buf2string(e.output,h);e.next_out=a,e.avail_out=s-a,a&&e.output.set(e.output.subarray(h,h+a),0),this.onData(o)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(i===G&&f===0)){if(i===de)return i=C.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};ee.prototype.onData=function(n){this.chunks.push(n)};ee.prototype.onEnd=function(n){n===G&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=tt.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};function Nn(n,t){const e=new ee(t);if(e.push(n),e.err)throw e.msg||_e[e.err];return e.result}function Cn(n,t){return t=t||{},t.raw=!0,Nn(n,t)}var Fn=Cn,Mn={inflateRaw:Fn};const{inflateRaw:Zn}=Mn;var Ln=Zn;function $n(n){return Ln(n.subarray(2))}class zn extends Error{constructor(t){super(t),this.code="ERR_ABORTED"}}function Hn(n){n.sort((r,i)=>r.offset-i.offset);const t=[];let e,s;for(const r of n)e&&s&&r.offset-s<=2e3?(e.length=e.length+r.length-s+r.offset,e.blocks.push(r)):t.push(e={blocks:[r],length:r.length,offset:r.offset}),s=e.offset+e.length;return t}function Y(n){if(n&&n.aborted)if(typeof DOMException>"u"){const t=new zn("aborted");throw t.code="ERR_ABORTED",t}else throw new DOMException("aborted","AbortError")}const ge=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function we(n,t,e,s){return n<s&&t>=e}class Vn{constructor(t,e,s,r,i,l){if(this.bbi=t,this.refsByName=e,this.cirTreeOffset=s,this.isBigEndian=r,this.isCompressed=i,this.blockType=l,this.featureCache=new wt({cache:new bt({maxSize:1e3}),fill:async(f,h)=>{const a=f.length,o=f.offset,{buffer:v}=await this.bbi.read(Q.Buffer.alloc(a),0,a,o,{signal:h});return v}}),!(s>=0))throw new Error("invalid cirTreeOffset!")}async readWigData(t,e,s,r,i){try{const{refsByName:l,bbi:f,cirTreeOffset:h,isBigEndian:a}=this,o=l[t];o===void 0&&r.complete();const v={chrId:o,start:e,end:s};this.cirTreePromise||(this.cirTreePromise=f.read(Q.Buffer.alloc(48),0,48,h,i));const{buffer:x}=await this.cirTreePromise,c=a?x.readUInt32BE(4):x.readUInt32LE(4);let b=[],B=0;const m=!0,y=(p,R,g)=>{try{const _=p.subarray(R),w=new DataView(_.buffer,_.byteOffset,_.length);let u=0;const D=w.getUint8(u);u+=2;const M=w.getUint16(u,m);if(u+=2,D===1){const I=[];for(let A=0;A<M;A++){const F=w.getUint32(u,m);u+=4;const te=w.getUint32(u,m);u+=4;const ne=w.getUint32(u,m);u+=4;const ie=w.getUint32(u,m);u+=4;const ae=Number(w.getBigUint64(u,m));u+=8;const se=Number(w.getBigUint64(u,m));u+=8,I.push({startChrom:F,startBase:te,endBase:ie,endChrom:ne,blockOffset:ae,blockSize:se,offset:u})}b=b.concat(I.filter(A=>k(A)).map(A=>({offset:A.blockOffset,length:A.blockSize})))}else if(D===0){const I=[];for(let F=0;F<M;F++){const te=w.getUint32(u,m);u+=4;const ne=w.getUint32(u,m);u+=4;const ie=w.getUint32(u,m);u+=4;const ae=w.getUint32(u,m);u+=4;const se=Number(w.getBigUint64(u,m));u+=8,I.push({startChrom:te,startBase:ne,endChrom:ie,endBase:ae,blockOffset:se,offset:u})}const A=I.filter(F=>k(F)).map(F=>F.blockOffset);A.length>0&&d(A,g+1)}}catch(E){r.error(E)}},k=p=>{const{startChrom:R,startBase:g,endChrom:E,endBase:_}=p;return(R<o||R===o&&g<=s)&&(E>o||E===o&&_>=e)},S=async(p,R,g)=>{try{const E=R.max-R.min,_=R.min,w=await this.featureCache.get(`${E}_${_}`,{length:E,offset:_},i==null?void 0:i.signal);for(const u of p)R.contains(u)&&(y(w,u-_,g),B-=1,B===0&&this.readFeatures(r,b,{...i,request:v}).catch(D=>{r.error(D)}))}catch(E){r.error(E)}},d=(p,R)=>{try{B+=p.length;const g=4+c*32;let E=new z([{min:p[0],max:p[0]+g}]);for(let _=1;_<p.length;_+=1){const w=new z([{min:p[_],max:p[_]+g}]);E=E.union(w)}E.getRanges().map(_=>S(p,_,R))}catch(g){r.error(g)}};d([Number(h)+48],1);return}catch(l){r.error(l)}}parseSummaryBlock(t,e,s){const r=[];let i=e;const l=new DataView(t.buffer,t.byteOffset,t.length);for(;i<t.byteLength;){const f=l.getUint32(i,!0);i+=4;const h=l.getUint32(i,!0);i+=4;const a=l.getUint32(i,!0);i+=4;const o=l.getUint32(i,!0);i+=4;const v=l.getFloat32(i,!0);i+=4;const x=l.getFloat32(i,!0);i+=4;const c=l.getFloat32(i,!0);i+=4,i+=4,(!s||f===s.chrId&&we(h,a,s.start,s.end))&&r.push({start:h,end:a,maxScore:x,minScore:v,summary:!0,score:c/(o||1)})}return r}parseBigBedBlock(t,e,s,r){var i;const l=[];let f=e;const h=!0,a=t,o=new DataView(a.buffer,a.byteOffset,a.length);for(;f<t.byteLength;){const v=f,x=o.getUint32(f,h);f+=4;const c=o.getInt32(f,h);f+=4;const b=o.getInt32(f,h);f+=4;let B=f;for(;B<t.length&&t[B]!==0;B++);const m=t.subarray(f,B),y=(i=ge==null?void 0:ge.decode(m))!==null&&i!==void 0?i:m.toString();f=B+1,l.push({chromId:x,start:c,end:b,rest:y,uniqueId:`bb-${s+v}`})}return r?l.filter(v=>we(v.start,v.end,r.start,r.end)):l}parseBigWigBlock(t,e,s){const r=t.subarray(e),i=new DataView(r.buffer,r.byteOffset,r.length);let l=0;l+=4;const f=i.getInt32(l,!0);l+=8;const h=i.getUint32(l,!0);l+=4;const a=i.getUint32(l,!0);l+=4;const o=i.getUint8(l);l+=2;const v=i.getUint16(l,!0);l+=2;const x=new Array(v);switch(o){case 1:{for(let c=0;c<v;c++){const b=i.getInt32(l,!0);l+=4;const B=i.getInt32(l,!0);l+=4;const m=i.getFloat32(l,!0);l+=4,x[c]={start:b,end:B,score:m}}break}case 2:{for(let c=0;c<v;c++){const b=i.getInt32(l,!0);l+=4;const B=i.getFloat32(l,!0);l+=4,x[c]={score:B,start:b,end:b+a}}break}case 3:{for(let c=0;c<v;c++){const b=i.getFloat32(l,!0);l+=4;const B=f+c*h;x[c]={score:b,start:B,end:B+a}}break}}return s?x.filter(c=>we(c.start,c.end,s.start,s.end)):x}async readFeatures(t,e,s={}){try{const{blockType:r,isCompressed:i}=this,{signal:l,request:f}=s,h=Hn(e);Y(l),await Promise.all(h.map(async a=>{Y(l);const{length:o,offset:v}=a,x=await this.featureCache.get(`${o}_${v}`,a,l);for(const c of a.blocks){Y(l);let b=Number(c.offset)-Number(a.offset),B=x;switch(i&&(B=$n(x.subarray(b)),b=0),Y(l),r){case"summary":{t.next(this.parseSummaryBlock(B,b,f));break}case"bigwig":{t.next(this.parseBigWigBlock(B,b,f));break}case"bigbed":{t.next(this.parseBigBedBlock(B,b,Number(c.offset)*256,f));break}default:console.warn(`Don't know what to do with ${r}`)}}})),t.complete()}catch(r){t.error(r)}}}const Ye=-2003829722,be=-2021002517;class Kn{getHeader(t){return this.headerP||(this.headerP=this._getHeader(t).catch(e=>{throw this.headerP=void 0,e})),this.headerP}constructor(t){const{filehandle:e,renameRefSeqs:s=l=>l,path:r,url:i}=t;if(this.renameRefSeqs=s,e)this.bbi=e;else if(i)this.bbi=new xt(i);else if(r)this.bbi=new _t(r);else throw new Error("no file given")}async _getHeader(t){const e=await this._getMainHeader(t),s=await this._readChromTree(e,t);return{...e,...s}}async _getMainHeader(t,e=2e3){const{buffer:r}=await this.bbi.read(Q.Buffer.alloc(e),0,e,0,t),i=this._isBigEndian(r),l=r,f=new DataView(l.buffer,l.byteOffset,l.length);let h=0;const a=f.getInt32(h,!0);h+=4;const o=f.getUint16(h,!0);h+=2;const v=f.getUint16(h,!0);h+=2;const x=Number(f.getBigUint64(h,!0));h+=8;const c=Number(f.getBigUint64(h,!0));h+=8;const b=Number(f.getBigUint64(h,!0));h+=8;const B=f.getUint16(h,!0);h+=2;const m=f.getUint16(h,!0);h+=2;const y=Number(f.getBigUint64(h,!0));h+=8;const k=Number(f.getBigUint64(h,!0));h+=8;const S=f.getUint32(h,!0);h+=4;const d=Number(f.getBigUint64(h,!0));h+=8;const p=[];for(let E=0;E<v;E++){const _=f.getUint32(h,!0);h+=4;const w=f.getUint32(h,!0);h+=4;const u=Number(f.getBigUint64(h,!0));h+=8;const D=Number(f.getBigUint64(h,!0));h+=8,p.push({reductionLevel:_,reserved:w,dataOffset:u,indexOffset:D})}const R=a===be?"bigbed":"bigwig";if(y>e||k>e-8*5)return this._getMainHeader(t,e*2);let g;if(k){const E=r.subarray(Number(k));let _=0;const w=new DataView(E.buffer,E.byteOffset,E.length),u=Number(w.getBigUint64(_,!0));_+=8;const D=w.getFloat64(_,!0);_+=8;const M=w.getFloat64(_,!0);_+=8;const I=w.getFloat64(_,!0);_+=8;const A=w.getFloat64(_,!0);_+=8,g={scoreMin:D,scoreMax:M,scoreSum:I,scoreSumSquares:A,basesCovered:u}}else throw new Error("no stats");return{zoomLevels:p,magic:a,extHeaderOffset:d,numZoomLevels:v,fieldCount:B,totalSummary:g,definedFieldCount:m,uncompressBufSize:S,asOffset:y,chromTreeOffset:x,totalSummaryOffset:k,unzoomedDataOffset:c,unzoomedIndexOffset:b,fileType:R,version:o,isBigEndian:i,autoSql:y?r.subarray(y,r.indexOf(0,y)).toString():""}}_isBigEndian(t){let e=t.readInt32LE(0);if(e===Ye||e===be)return!1;if(e=t.readInt32BE(0),e===Ye||e===be)return!0;throw new Error("not a BigWig/BigBed file")}async _readChromTree(t,e){const r=!t.isBigEndian,i=[],l={};let f=t.unzoomedDataOffset;const h=t.chromTreeOffset;for(;f%4!==0;)f+=1;const a=f-h,{buffer:o}=await this.bbi.read(Q.Buffer.alloc(a),0,a,Number(h),e),v=o,x=new DataView(v.buffer,v.byteOffset,v.length);let c=0;c+=4,c+=4;const b=x.getUint32(c,r);c+=4,c+=4,c+=8;const B=32,m=async y=>{let k=y;if(k>=o.length)throw new Error("reading beyond end of buffer");const S=x.getUint8(k);k+=2;const d=x.getUint16(k,r);if(k+=2,S)for(let p=0;p<d;p++){const R=o.subarray(k,k+b).toString().replaceAll("\0","");k+=b;const g=x.getUint32(k,r);k+=4;const E=x.getUint32(k,r);k+=4;const _={name:R,id:g,length:E};l[this.renameRefSeqs(R)]=g,i[g]=_}else{const p=[];for(let R=0;R<d;R++){k+=b;const g=Number(x.getBigUint64(k,r));k+=8,p.push(m(Number(g)-Number(h)))}await Promise.all(p)}};return await m(B),{refsByName:l,refsByNumber:i}}async getUnzoomedView(t){const{unzoomedIndexOffset:e,refsByName:s,uncompressBufSize:r,isBigEndian:i,fileType:l}=await this.getHeader(t);return new Vn(this.bbi,s,e,i,r>0,l)}async getFeatureStream(t,e,s,r){await this.getHeader(r);const i=this.renameRefSeqs(t);let l;const{basesPerSpan:f,scale:h}=r||{};return f?l=await this.getView(1/f,r):h?l=await this.getView(h,r):l=await this.getView(1,r),new pt(a=>{l.readWigData(i,e,s,a,r).catch(o=>{a.error(o)})})}async getFeatures(t,e,s,r){const i=await this.getFeatureStream(t,e,s,r);return(await mt(i.pipe(kt()))).flat()}}export{Kn as B,Vn as a};
//# sourceMappingURL=bbi-Ci_jxKgh.js.map
