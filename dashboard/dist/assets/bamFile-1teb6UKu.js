import{bG as G,aT as F,aV as j,aW as H,a_ as R,bH as C,aN as k,bI as $}from"./index-CTn4VqQ6.js";import{c as V}from"./crc32-SRMaWgja.js";class N{constructor(t,e){this.blockPosition=t,this.dataPosition=e}toString(){return`${this.blockPosition}:${this.dataPosition}`}compareTo(t){return this.blockPosition-t.blockPosition||this.dataPosition-t.dataPosition}static min(...t){let e,n=0;for(;!e;n+=1)e=t[n];for(;n<t.length;n+=1)e.compareTo(t[n])>0&&(e=t[n]);return e}}function y(o,t=0,e=!1){if(e)throw new Error("big-endian virtual file offsets not implemented");return new N(o[t+7]*1099511627776+o[t+6]*4294967296+o[t+5]*16777216+o[t+4]*65536+o[t+3]*256+o[t+2],o[t+1]<<8|o[t])}class B{constructor(t,e,n,i){this.minv=t,this.maxv=e,this.bin=n,this._fetchedSize=i}toUniqueString(){return`${this.minv.toString()}..${this.maxv.toString()} (bin ${this.bin}, fetchedSize ${this.fetchedSize()})`}toString(){return this.toUniqueString()}compareTo(t){return this.minv.compareTo(t.minv)||this.maxv.compareTo(t.maxv)||this.bin-t.bin}fetchedSize(){return this._fetchedSize!==void 0?this._fetchedSize:this.maxv.blockPosition+65536-this.minv.blockPosition}}function Y(o){return new Promise(t=>setTimeout(t,o))}function Q(o){if(o&&o.aborted)if(typeof DOMException>"u"){const t=new Error("aborted");throw t.code="ERR_ABORTED",t}else throw new DOMException("aborted","AbortError")}function W(o,t){return t.minv.blockPosition-o.maxv.blockPosition<65e3&&t.maxv.blockPosition-o.minv.blockPosition<5e6}function J(o={}){return"aborted"in o?{signal:o}:o}function O(o,t){const e=[];let n;if(o.length===0)return o;o.sort((i,s)=>{const r=i.minv.blockPosition-s.minv.blockPosition;return r===0?i.minv.dataPosition-s.minv.dataPosition:r});for(const i of o)(!t||i.maxv.compareTo(t)>0)&&(n===void 0?(e.push(i),n=i):W(n,i)?i.maxv.compareTo(n.maxv)>0&&(n.maxv=i.maxv):(e.push(i),n=i));return e}function U(o,t){return{lineCount:G.fromBytesLE(Array.prototype.slice.call(o,t,t+8),!0).toNumber()}}function P(o,t){return o?o.compareTo(t)>0?t:o:t}function K(o,t=e=>e){let e=0,n=0;const i=[],s={};for(let r=0;r<o.length;r+=1)if(!o[r]){if(n<r){let a=o.toString("utf8",n,r);a=t(a),i[e]=a,s[a]=e}n=r+1,e+=1}return{refNameToId:s,refIdToName:i}}class z{constructor({filehandle:t,renameRefSeq:e=n=>n}){this.filehandle=t,this.renameRefSeq=e}}const X=21578050;function Z(o,t){return o-o%t}function ee(o,t){return o-o%t+t}function te(o,t){return t-=1,[[0,0],[1+(o>>26),1+(t>>26)],[9+(o>>23),9+(t>>23)],[73+(o>>20),73+(t>>20)],[585+(o>>17),585+(t>>17)],[4681+(o>>14),4681+(t>>14)]]}class I extends z{async lineCount(t,e){var n,i;return((i=(n=(await this.parse(e)).indices[t])===null||n===void 0?void 0:n.stats)===null||i===void 0?void 0:i.lineCount)||0}async _parse(t){const e=await this.filehandle.readFile(t);if(e.readUInt32LE(0)!==X)throw new Error("Not a BAI file");const n=e.readInt32LE(4),s=((1<<(5+1)*3)-1)/7;let r=8,a;const c=new Array(n);for(let l=0;l<n;l++){const h=e.readInt32LE(r);let d;r+=4;const u={};for(let m=0;m<h;m+=1){const g=e.readUInt32LE(r);if(r+=4,g===s+1)r+=4,d=U(e,r+16),r+=32;else{if(g>s+1)throw new Error("bai index contains too many bins, please use CSI");{const b=e.readInt32LE(r);r+=4;const x=new Array(b);for(let w=0;w<b;w++){const E=y(e,r);r+=8;const L=y(e,r);r+=8,a=P(a,E),x[w]=new B(E,L,g)}u[g]=x}}}const f=e.readInt32LE(r);r+=4;const p=new Array(f);for(let m=0;m<f;m++){const g=y(e,r);r+=8,a=P(a,g),p[m]=g}c[l]={binIndex:u,linearIndex:p,stats:d}}return{bai:!0,firstDataLine:a,maxBlockSize:65536,indices:c,refCount:n}}async indexCov(t,e,n,i={}){const r=e!==void 0,c=(await this.parse(i)).indices[t];if(!c)return[];const{linearIndex:l=[],stats:h}=c;if(l.length===0)return[];const d=n===void 0?(l.length-1)*16384:ee(n,16384),u=e===void 0?0:Z(e,16384),f=r?new Array((d-u)/16384):new Array(l.length-1),p=l[l.length-1].blockPosition;if(d>(l.length-1)*16384)throw new Error("query outside of range of linear index");let m=l[u/16384].blockPosition;for(let g=u/16384,b=0;g<d/16384;g++,b++)f[b]={score:l[g+1].blockPosition-m,start:g*16384,end:g*16384+16384},m=l[g+1].blockPosition;return f.map(g=>({...g,score:g.score*((h==null?void 0:h.lineCount)||0)/p}))}async blocksForRange(t,e,n,i={}){e<0&&(e=0);const s=await this.parse(i);if(!s)return[];const r=s.indices[t];if(!r)return[];const a=te(e,n),c=[];for(const[f,p]of a)for(let m=f;m<=p;m++)if(r.binIndex[m]){const g=r.binIndex[m];for(const b of g)c.push(new B(b.minv,b.maxv,m))}const l=r.linearIndex.length;let h;const d=Math.min(e>>14,l-1),u=Math.min(n>>14,l-1);for(let f=d;f<=u;++f){const p=r.linearIndex[f];p&&(!h||p.compareTo(h)<0)&&(h=p)}return O(c,h)}async parse(t={}){return this.setupP||(this.setupP=this._parse(t).catch(e=>{throw this.setupP=void 0,e})),this.setupP}async hasRefSeq(t,e={}){var n;return!!(!((n=(await this.parse(e)).indices[t])===null||n===void 0)&&n.binIndex)}}const ne=21582659,ie=38359875;function se(o,t){return o*2**t}function T(o,t){return Math.floor(o/2**t)}class M extends z{constructor(){super(...arguments),this.maxBinNumber=0,this.depth=0,this.minShift=0}async lineCount(t,e){var n,i;return((i=(n=(await this.parse(e)).indices[t])===null||n===void 0?void 0:n.stats)===null||i===void 0?void 0:i.lineCount)||0}async indexCov(){return[]}parseAuxData(t,e){const n=t.readInt32LE(e),i=n&65536?"zero-based-half-open":"1-based-closed",s={0:"generic",1:"SAM",2:"VCF"}[n&15];if(!s)throw new Error(`invalid Tabix preset format flags ${n}`);const r={ref:t.readInt32LE(e+4),start:t.readInt32LE(e+8),end:t.readInt32LE(e+12)},a=t.readInt32LE(e+16),c=a?String.fromCharCode(a):"",l=t.readInt32LE(e+20),h=t.readInt32LE(e+24);return{columnNumbers:r,coordinateType:i,metaValue:a,metaChar:c,skipLines:l,format:s,formatFlags:n,...K(t.subarray(e+28,e+28+h),this.renameRefSeq)}}async _parse(t){const e=await this.filehandle.readFile(t),n=await F(e);let i;if(n.readUInt32LE(0)===ne)i=1;else if(n.readUInt32LE(0)===ie)i=2;else throw new Error("Not a CSI file");this.minShift=n.readInt32LE(4),this.depth=n.readInt32LE(8),this.maxBinNumber=((1<<(this.depth+1)*3)-1)/7;const s=n.readInt32LE(12),r=s>=30?this.parseAuxData(n,16):void 0,a=n.readInt32LE(16+s);let c=16+s+4,l;const h=new Array(a);for(let d=0;d<a;d++){const u=n.readInt32LE(c);c+=4;const f={};let p;for(let m=0;m<u;m++){const g=n.readUInt32LE(c);if(c+=4,g>this.maxBinNumber)p=U(n,c+28),c+=44;else{l=P(l,y(n,c)),c+=8;const b=n.readInt32LE(c);c+=4;const x=new Array(b);for(let w=0;w<b;w+=1){const E=y(n,c);c+=8;const L=y(n,c);c+=8,l=P(l,E),x[w]=new B(E,L,g)}f[g]=x}}h[d]={binIndex:f,stats:p}}return{csiVersion:i,firstDataLine:l,indices:h,refCount:a,csi:!0,maxBlockSize:65536,...r}}async blocksForRange(t,e,n,i={}){e<0&&(e=0);const r=(await this.parse(i)).indices[t];if(!r)return[];const a=this.reg2bins(e,n);if(a.length===0)return[];const c=[];for(const[l,h]of a)for(let d=l;d<=h;d++)if(r.binIndex[d]){const u=r.binIndex[d];for(const f of u)c.push(f)}return O(c,new N(0,0))}reg2bins(t,e){t-=1,t<1&&(t=1),e>2**50&&(e=2**34),e-=1;let n=0,i=0,s=this.minShift+this.depth*3;const r=[];for(;n<=this.depth;s-=3,i+=se(1,n*3),n+=1){const a=i+T(t,s),c=i+T(e,s);if(c-a+r.length>this.maxBinNumber)throw new Error(`query ${t}-${e} is too large for current binning scheme (shift ${this.minShift}, depth ${this.depth}), try a smaller query or a coarser index binning scheme`);r.push([a,c])}return r}async parse(t={}){return this.setupP||(this.setupP=this._parse(t).catch(e=>{throw this.setupP=void 0,e})),this.setupP}async hasRefSeq(t,e={}){var n;return!!(!((n=(await this.parse(e)).indices[t])===null||n===void 0)&&n.binIndex)}}const _={BAM_FPAIRED:1,BAM_FPROPER_PAIR:2,BAM_FUNMAP:4,BAM_FMUNMAP:8,BAM_FREVERSE:16,BAM_FMREVERSE:32,BAM_FREAD1:64,BAM_FREAD2:128,BAM_FSECONDARY:256,BAM_FQCFAIL:512,BAM_FDUP:1024,BAM_FSUPPLEMENTARY:2048},D="=ACMGRSVTWYHKDBN".split(""),v="MIDNSHP=X???????".split("");class A{constructor(t){this.bytes=t.bytes,this.fileOffset=t.fileOffset}get byteArray(){return this.bytes.byteArray}get flags(){return(this.byteArray.readInt32LE(this.bytes.start+16)&4294901760)>>16}get ref_id(){return this.byteArray.readInt32LE(this.bytes.start+4)}get start(){return this.byteArray.readInt32LE(this.bytes.start+8)}get end(){return this.start+this.length_on_ref}get id(){return this.fileOffset}get mq(){const t=(this.bin_mq_nl&65280)>>8;return t===255?void 0:t}get score(){return this.mq}get qual(){if(this.isSegmentUnmapped())return;const t=this.b0+this.read_name_length+this.num_cigar_ops*4+this.num_seq_bytes;return this.byteArray.subarray(t,t+this.seq_length)}get strand(){return this.isReverseComplemented()?-1:1}get b0(){return this.bytes.start+36}get name(){return this.byteArray.toString("ascii",this.b0,this.b0+this.read_name_length-1)}get tags(){const{byteArray:t}=this.bytes;let e=this.b0+this.read_name_length+this.num_cigar_ops*4+this.num_seq_bytes+this.seq_length;const n=this.bytes.end,i={};for(;e<n;){const s=String.fromCharCode(t[e],t[e+1]),r=String.fromCharCode(t[e+2]);if(e+=3,r==="A")i[s]=String.fromCharCode(t[e]),e+=1;else if(r==="i")i[s]=t.readInt32LE(e),e+=4;else if(r==="I")i[s]=t.readUInt32LE(e),e+=4;else if(r==="c")i[s]=t.readInt8(e),e+=1;else if(r==="C")i[s]=t.readUInt8(e),e+=1;else if(r==="s")i[s]=t.readInt16LE(e),e+=2;else if(r==="S")i[s]=t.readUInt16LE(e),e+=2;else if(r==="f")i[s]=t.readFloatLE(e),e+=4;else if(r==="Z"||r==="H"){const a=[];for(;e<=n;){const c=t[e++];if(c!==0)a.push(String.fromCharCode(c));else break}i[s]=a.join("")}else if(r==="B"){const a=t[e++],c=String.fromCharCode(a),l=t.readInt32LE(e);if(e+=4,c==="i")if(s==="CG"){const h=[];for(let d=0;d<l;d++){const u=t.readInt32LE(e),f=u>>4,p=v[u&15];h.push(f+p),e+=4}i[s]=h.join("")}else{const h=[];for(let d=0;d<l;d++)h.push(t.readInt32LE(e)),e+=4;i[s]=h}else if(c==="I")if(s==="CG"){const h=[];for(let d=0;d<l;d++){const u=t.readUInt32LE(e),f=u>>4,p=v[u&15];h.push(f+p),e+=4}i[s]=h.join("")}else{const h=[];for(let d=0;d<l;d++)h.push(t.readUInt32LE(e)),e+=4;i[s]=h}else if(c==="s"){const h=[];for(let d=0;d<l;d++)h.push(t.readInt16LE(e)),e+=2;i[s]=h}else if(c==="S"){const h=[];for(let d=0;d<l;d++)h.push(t.readUInt16LE(e)),e+=2;i[s]=h}else if(c==="c"){const h=[];for(let d=0;d<l;d++)h.push(t.readInt8(e)),e+=1;i[s]=h}else if(c==="C"){const h=[];for(let d=0;d<l;d++)h.push(t.readUInt8(e)),e+=1;i[s]=h}else if(c==="f"){const h=[];for(let d=0;d<l;d++)h.push(t.readFloatLE(e)),e+=4;i[s]=h}}else{console.error("Unknown BAM tag type",r);break}}return i}isPaired(){return!!(this.flags&_.BAM_FPAIRED)}isProperlyPaired(){return!!(this.flags&_.BAM_FPROPER_PAIR)}isSegmentUnmapped(){return!!(this.flags&_.BAM_FUNMAP)}isMateUnmapped(){return!!(this.flags&_.BAM_FMUNMAP)}isReverseComplemented(){return!!(this.flags&_.BAM_FREVERSE)}isMateReverseComplemented(){return!!(this.flags&_.BAM_FMREVERSE)}isRead1(){return!!(this.flags&_.BAM_FREAD1)}isRead2(){return!!(this.flags&_.BAM_FREAD2)}isSecondary(){return!!(this.flags&_.BAM_FSECONDARY)}isFailedQc(){return!!(this.flags&_.BAM_FQCFAIL)}isDuplicate(){return!!(this.flags&_.BAM_FDUP)}isSupplementary(){return!!(this.flags&_.BAM_FSUPPLEMENTARY)}get cigarAndLength(){if(this.isSegmentUnmapped())return{length_on_ref:0,CIGAR:""};const t=this.num_cigar_ops;let e=this.b0+this.read_name_length;const n=[];let i=this.byteArray.readInt32LE(e),s=i>>4,r=v[i&15];if(r==="S"&&s===this.seq_length)return e+=4,i=this.byteArray.readInt32LE(e),s=i>>4,r=v[i&15],r!=="N"&&console.warn("CG tag with no N tag"),{CIGAR:this.tags.CG,length_on_ref:s};{let a=0;for(let c=0;c<t;++c)i=this.byteArray.readInt32LE(e),s=i>>4,r=v[i&15],n.push(s+r),r!=="H"&&r!=="S"&&r!=="I"&&(a+=s),e+=4;return{CIGAR:n.join(""),length_on_ref:a}}}get length_on_ref(){return this.cigarAndLength.length_on_ref}get CIGAR(){return this.cigarAndLength.CIGAR}get num_cigar_ops(){return this.flag_nc&65535}get read_name_length(){return this.bin_mq_nl&255}get num_seq_bytes(){return this.seq_length+1>>1}get seq(){const{byteArray:t}=this.bytes,e=this.b0+this.read_name_length+this.num_cigar_ops*4,n=this.num_seq_bytes,i=this.seq_length,s=[];let r=0;for(let a=0;a<n;++a){const c=t[e+a];s.push(D[(c&240)>>4]),r++,r<i&&(s.push(D[c&15]),r++)}return s.join("")}get pair_orientation(){if(!this.isSegmentUnmapped()&&!this.isMateUnmapped()&&this.ref_id===this.next_refid){const t=this.isReverseComplemented()?"R":"F",e=this.isMateReverseComplemented()?"R":"F";let n=" ",i=" ";this.isRead1()?(n="1",i="2"):this.isRead2()&&(n="2",i="1");const s=[];return this.template_length>0?(s[0]=t,s[1]=n,s[2]=e,s[3]=i):(s[2]=t,s[3]=n,s[0]=e,s[1]=i),s.join("")}}get bin_mq_nl(){return this.byteArray.readInt32LE(this.bytes.start+12)}get flag_nc(){return this.byteArray.readInt32LE(this.bytes.start+16)}get seq_length(){return this.byteArray.readInt32LE(this.bytes.start+20)}get next_refid(){return this.byteArray.readInt32LE(this.bytes.start+24)}get next_pos(){return this.byteArray.readInt32LE(this.bytes.start+28)}get template_length(){return this.byteArray.readInt32LE(this.bytes.start+32)}toJSON(){const t={};for(const e of Object.keys(this))e.startsWith("_")||e==="bytes"||(t[e]=this[e]);return t}}function S(o,t){const e=Object.getOwnPropertyDescriptor(o.prototype,t);if(!e)throw new Error("OH NO, NO PROPERTY DESCRIPTOR");const n=e.get;if(!n)throw new Error("OH NO, NOT A GETTER");Object.defineProperty(o.prototype,t,{get(){const i=n.call(this);return Object.defineProperty(this,t,{value:i}),i}})}S(A,"tags");S(A,"cigarAndLength");S(A,"seq");S(A,"qual");function re(o){const t=o.split(/\r?\n/),e=[];for(const n of t){const[i,...s]=n.split(/\t/);i&&e.push({tag:i.slice(1),data:s.map(r=>{const a=r.indexOf(":"),c=r.slice(0,a),l=r.slice(a+1);return{tag:c,value:l}})})}return e}const ae=21840194,q=65536;async function oe(o){let t=[];for await(const e of o)t=t.concat(e);return t}class ce{read(){throw new Error("never called")}stat(){throw new Error("never called")}readFile(){throw new Error("never called")}close(){throw new Error("never called")}}class de{constructor({bamFilehandle:t,bamPath:e,bamUrl:n,baiPath:i,baiFilehandle:s,baiUrl:r,csiPath:a,csiFilehandle:c,csiUrl:l,htsget:h,yieldThreadTime:d=100,renameRefSeqs:u=f=>f}){if(this.htsget=!1,this.featureCache=new j({cache:new H({maxSize:50}),fill:async(f,p)=>{const{chunk:m,opts:g}=f,{data:b,cpositions:x,dpositions:w}=await this._readChunk({chunk:m,opts:{...g,signal:p}});return this.readBamFeatures(b,x,w,m)}}),this.renameRefSeq=u,t)this.bam=t;else if(e)this.bam=new R(e);else if(n)this.bam=new C(n);else if(h)this.htsget=!0,this.bam=new ce;else throw new Error("unable to initialize bam");if(c)this.index=new M({filehandle:c});else if(a)this.index=new M({filehandle:new R(a)});else if(l)this.index=new M({filehandle:new C(l)});else if(s)this.index=new I({filehandle:s});else if(i)this.index=new I({filehandle:new R(i)});else if(r)this.index=new I({filehandle:new C(r)});else if(e)this.index=new I({filehandle:new R(`${e}.bai`)});else if(n)this.index=new I({filehandle:new C(`${n}.bai`)});else if(h)this.htsget=!0;else throw new Error("unable to infer index format");this.yieldThreadTime=d}async getHeaderPre(t){const e=J(t);if(!this.index)return;const n=await this.index.parse(e),i=n.firstDataLine?n.firstDataLine.blockPosition+65535:void 0;let s;if(i){const h=i+q,d=await this.bam.read(k.Buffer.alloc(h),0,h,0,e);if(!d.bytesRead)throw new Error("Error reading header");s=d.buffer.subarray(0,Math.min(d.bytesRead,i))}else s=await this.bam.readFile(e);const r=await F(s);if(r.readInt32LE(0)!==ae)throw new Error("Not a BAM file");const a=r.readInt32LE(4);this.header=r.toString("utf8",8,8+a);const{chrToIndex:c,indexToChr:l}=await this._readRefSeqs(a+8,65535,e);return this.chrToIndex=c,this.indexToChr=l,re(this.header)}getHeader(t){return this.headerP||(this.headerP=this.getHeaderPre(t).catch(e=>{throw this.headerP=void 0,e})),this.headerP}async getHeaderText(t={}){return await this.getHeader(t),this.header}async _readRefSeqs(t,e,n){if(t>e)return this._readRefSeqs(t,e*2,n);const i=e+q,{bytesRead:s,buffer:r}=await this.bam.read(k.Buffer.alloc(i),0,e,0,n);if(!s)throw new Error("Error reading refseqs from header");const a=await F(r.subarray(0,Math.min(s,e))),c=a.readInt32LE(t);let l=t+4;const h={},d=[];for(let u=0;u<c;u+=1){const f=a.readInt32LE(l),p=this.renameRefSeq(a.toString("utf8",l+4,l+4+f-1)),m=a.readInt32LE(l+f+4);if(h[p]=u,d.push({refName:p,length:m}),l=l+8+f,l>a.length)return console.warn(`BAM header is very big.  Re-fetching ${e} bytes.`),this._readRefSeqs(t,e*2,n)}return{chrToIndex:h,indexToChr:d}}async getRecordsForRange(t,e,n,i){return oe(this.streamRecordsForRange(t,e,n,i))}async*streamRecordsForRange(t,e,n,i){var s;await this.getHeader(i);const r=(s=this.chrToIndex)===null||s===void 0?void 0:s[t];if(r===void 0||!this.index)yield[];else{const a=await this.index.blocksForRange(r,e-1,n,i);yield*this._fetchChunkFeatures(a,r,e,n,i)}}async*_fetchChunkFeatures(t,e,n,i,s={}){const{viewAsPairs:r}=s,a=[];let c=!1;for(const l of t){const h=await this.featureCache.get(l.toString(),{chunk:l,opts:s},s.signal),d=[];for(const u of h)if(u.ref_id===e)if(u.start>=i){c=!0;break}else u.end>=n&&d.push(u);if(a.push(d),yield d,c)break}Q(s.signal),r&&(yield this.fetchPairs(e,a,s))}async fetchPairs(t,e,n){const{pairAcrossChr:i,maxInsertSize:s=2e5}=n,r={},a={};e.map(u=>{const f={};for(const p of u){const m=p.name,g=p.id;f[m]||(f[m]=0),f[m]++,a[g]=1}for(const[p,m]of Object.entries(f))m===1&&(r[p]=!0)});const c=[];e.map(u=>{for(const f of u){const p=f.name,m=f.start,g=f.next_pos,b=f.next_refid;this.index&&r[p]&&(i||b===t&&Math.abs(m-g)<s)&&c.push(this.index.blocksForRange(b,g,g+1,n))}});const l=new Map,h=await Promise.all(c);for(const u of h.flat())l.has(u.toString())||l.set(u.toString(),u);return(await Promise.all([...l.values()].map(async u=>{const{data:f,cpositions:p,dpositions:m,chunk:g}=await this._readChunk({chunk:u,opts:n}),b=[];for(const x of await this.readBamFeatures(f,p,m,g))r[x.name]&&!a[x.id]&&b.push(x);return b}))).flat()}async _readRegion(t,e,n={}){const{bytesRead:i,buffer:s}=await this.bam.read(k.Buffer.alloc(e),0,e,t,n);return s.subarray(0,Math.min(i,e))}async _readChunk({chunk:t,opts:e}){const n=await this._readRegion(t.minv.blockPosition,t.fetchedSize(),e),{buffer:i,cpositions:s,dpositions:r}=await $(n,t);return{data:i,cpositions:s,dpositions:r,chunk:t}}async readBamFeatures(t,e,n,i){let s=0;const r=[];let a=0,c=+Date.now();for(;s+4<t.length;){const l=t.readInt32LE(s),h=s+4+l-1;if(n){for(;s+i.minv.dataPosition>=n[a++];);a--}if(h<t.length){const d=new A({bytes:{byteArray:t,start:s,end:h},fileOffset:e.length>0?e[a]*256+(s-n[a])+i.minv.dataPosition+1:V.signed(t.slice(s,h))});r.push(d),this.yieldThreadTime&&+Date.now()-c>this.yieldThreadTime&&(await Y(1),c=+Date.now())}s=h+1}return r}async hasRefSeq(t){var e,n;const i=(e=this.chrToIndex)===null||e===void 0?void 0:e[t];return i===void 0?!1:(n=this.index)===null||n===void 0?void 0:n.hasRefSeq(i)}async lineCount(t){var e;const n=(e=this.chrToIndex)===null||e===void 0?void 0:e[t];return n===void 0||!this.index?0:this.index.lineCount(n)}async indexCov(t,e,n){var i;if(!this.index)return[];await this.index.parse();const s=(i=this.chrToIndex)===null||i===void 0?void 0:i[t];return s===void 0?[]:this.index.indexCov(s,e,n)}async blocksForRange(t,e,n,i){var s;if(!this.index)return[];await this.index.parse();const r=(s=this.chrToIndex)===null||s===void 0?void 0:s[t];return r===void 0?[]:this.index.blocksForRange(r,e,n,i)}}export{de as B,ae as a,re as p};
//# sourceMappingURL=bamFile-1teb6UKu.js.map
